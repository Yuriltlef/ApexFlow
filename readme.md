# ApexFlow - ç”µå•†ä¿¡æ¯ç®¡ç†ç³»ç»Ÿ

![License: GPL v3](https://img.shields.io/badge/License-GPLv3-blue.svg)
![Vue.js](https://img.shields.io/badge/Vue.js-3.x-42b883.svg)
![Java](https://img.shields.io/badge/Java-17-007396.svg)
![Tomcat](https://img.shields.io/badge/Tomcat-9.x-F8DC75.svg)
![MySQL](https://img.shields.io/badge/MySQL-8.0+-4479A1.svg)
![Build Status](https://img.shields.io/badge/build-passing-brightgreen.svg)

## ğŸ“‹ é¡¹ç›®ç®€ä»‹

**ApexFlow** æ˜¯ä¸€ä¸ªå¼€æºçš„ç”µå•†ä¿¡æ¯ç®¡ç†ç³»ç»Ÿï¼Œä¸“ä¸ºä¸­å°å‹ç”µå•†å•†å®¶è®¾è®¡ã€‚ç³»ç»Ÿé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œå‰ç«¯ä½¿ç”¨Vue 3.xï¼Œåç«¯åŸºäºJava ServletæŠ€æœ¯ï¼Œç”±Tomcatç›´æ¥æ‰˜ç®¡éƒ¨ç½²ï¼Œæ— éœ€Nginxç­‰åå‘ä»£ç†æœåŠ¡å™¨ã€‚é¡¹ç›®éµå¾ªGPL-3.0å¼€æºåè®®ï¼Œå®Œå…¨å…è´¹ä½¿ç”¨å’Œä¿®æ”¹ã€‚

### âœ¨ æ ¸å¿ƒç‰¹æ€§

- **ä¸€ä½“åŒ–éƒ¨ç½²**ï¼šå‰åç«¯ç»Ÿä¸€ç”±Tomcatæ‰˜ç®¡ï¼Œç®€åŒ–éƒ¨ç½²æµç¨‹
- **æ¨¡å—åŒ–ç®¡ç†**ï¼šå…­å¤§æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ï¼Œè¦†ç›–ç”µå•†è¿è¥å…¨æµç¨‹
- **ç°ä»£åŒ–ç•Œé¢**ï¼šåŸºäºVue 3 + Element Plusçš„å“åº”å¼è®¾è®¡
- **RESTful API**ï¼šæ ‡å‡†åŒ–æ¥å£è®¾è®¡ï¼Œä¾¿äºé›†æˆå’Œæ‰©å±•
- **å¼€æºè‡ªç”±**ï¼šGPL-3.0åè®®ï¼Œæ”¯æŒäºŒæ¬¡å¼€å‘å’Œå•†ä¸šåº”ç”¨

## ğŸ—‚ï¸ åŠŸèƒ½æ¨¡å—

| æ¨¡å— | æ ¸å¿ƒåŠŸèƒ½ | çŠ¶æ€ |
|------|----------|------|
| **è®¢å•ç®¡ç†** | è®¢å•åˆ›å»º/æŸ¥è¯¢/ç­›é€‰ï¼Œè®¢å•çŠ¶æ€è·Ÿè¸ªï¼Œæ‰¹é‡æ“ä½œ | âœ… å·²å®Œæˆ |
| **ç‰©æµç®¡ç†** | ç‰©æµå…¬å¸å¯¹æ¥ï¼Œè¿å•ç®¡ç†ï¼Œç‰©æµè½¨è¿¹æŸ¥è¯¢ | âœ… å·²å®Œæˆ |
| **å”®åç®¡ç†** | é€€è´§/æ¢è´§ç”³è¯·å¤„ç†ï¼Œé€€æ¬¾ç®¡ç†ï¼Œå”®åè®°å½• | âœ… å·²å®Œæˆ |
| **è¯„ä»·ç®¡ç†** | å•†å“è¯„ä»·æŸ¥çœ‹ï¼Œå›å¤è¯„ä»·ï¼Œè¯„ä»·æ•°æ®åˆ†æ | ğŸš§ å¼€å‘ä¸­ |
| **ä»“åº“ç®¡ç†** | åº“å­˜ç®¡ç†ï¼Œå…¥åº“/å‡ºåº“è®°å½•ï¼Œåº“å­˜é¢„è­¦ | ğŸš§ å¼€å‘ä¸­ |
| **è´¢åŠ¡ç®¡ç†** | æ”¶æ”¯ç»Ÿè®¡ï¼Œè´¢åŠ¡æŠ¥è¡¨ï¼Œè´¦å•ç®¡ç† | ğŸ”„ è§„åˆ’ä¸­ |

## ğŸ› ï¸ æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ

**å‰ç«¯ (Vue 3.x)**
- **æ¡†æ¶**: Vue 3.x (ç»„åˆå¼API)
- **UIç»„ä»¶åº“**: Element Plus
- **çŠ¶æ€ç®¡ç†**: Pinia
- **è·¯ç”±ç®¡ç†**: Vue Router 4
- **HTTPå®¢æˆ·ç«¯**: Axios
- **æ„å»ºå·¥å…·**: Vite
- **æ ·å¼é¢„å¤„ç†**: SCSS

**åç«¯ (Java Servlet)**
- **æœåŠ¡å™¨**: Apache Tomcat 9.x
- **Javaç‰ˆæœ¬**: JDK 8+
- **Webæ¡†æ¶**: Servlet 4.0
- **æ•°æ®åº“**: MySQL 5.7+
- **è¿æ¥æ± **: HikariCP
- **JSONå¤„ç†**: Jackson
- **æ—¥å¿—æ¡†æ¶**: Log4j2

**å¼€å‘å·¥å…·**
- **IDE**: IntelliJ IDEA / Eclipse + VS Code
- **æ„å»ºå·¥å…·**: Maven 3.6+
- **æ•°æ®åº“å·¥å…·**: MySQL Workbench
- **ç‰ˆæœ¬æ§åˆ¶**: Git

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           æµè§ˆå™¨å®¢æˆ·ç«¯ (Vue SPA)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ HTTP/HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Apache Tomcat 9.x            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚      apexflow-web (é™æ€èµ„æº)     â”‚   â”‚
â”‚   â”‚  â”œâ”€â”€ index.html                 â”‚   â”‚
â”‚   â”‚  â”œâ”€â”€ static/                    â”‚   â”‚
â”‚   â”‚  â””â”€â”€ assets/                    â”‚   â”‚
â”‚   â”‚                                 â”‚   â”‚
â”‚   â”‚      apexflow-server (Java)     â”‚   â”‚
â”‚   â”‚  â”œâ”€â”€ Servlet Controllers        â”‚   â”‚
â”‚   â”‚  â”œâ”€â”€ DAO/Service å±‚             â”‚   â”‚
â”‚   â”‚  â””â”€â”€ Filters/Listeners          â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                  â”‚                      â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚           â”‚    MySQL     â”‚              â”‚
â”‚           â”‚   æ•°æ®åº“      â”‚              â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
apexflow/ (é¡¹ç›®æ ¹ç›®å½•)
â”œâ”€â”€ apexflow-web/              # Vueå‰ç«¯æºç ï¼ˆç‹¬ç«‹å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/              # APIæ¥å£å°è£…
â”‚   â”‚   â”œâ”€â”€ assets/           # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ components/       # ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ router/           # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ stores/           # PiniaçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ views/            # é¡µé¢ç»„ä»¶
â”‚   â”‚   â””â”€â”€ utils/            # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vue.config.js         # æ„å»ºé…ç½®
â”‚
â””â”€â”€ apexflow-server/          # Java Webé¡¹ç›®
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ main/
    â”‚   â”‚   â”œâ”€â”€ java/
    â”‚   â”‚   â”‚   â””â”€â”€ com/
    â”‚   â”‚   â”‚       â””â”€â”€ apex/
    â”‚   â”‚   â”‚           â”œâ”€â”€ config/           # é…ç½®ç±»
    â”‚   â”‚   â”‚           â”‚   â”œâ”€â”€ CORSFilter.java
    â”‚   â”‚   â”‚           â”‚   â”œâ”€â”€ SpaFilter.java
    â”‚   â”‚   â”‚           â”‚   â””â”€â”€ DatabaseConfig.java
    â”‚   â”‚   â”‚           â”œâ”€â”€ core/             # æ ¸å¿ƒä¸šåŠ¡
    â”‚   â”‚   â”‚           â”‚   â”œâ”€â”€ controller/   # æ§åˆ¶å™¨å±‚
    â”‚   â”‚   â”‚           â”‚   â”‚   â”œâ”€â”€ OrderController.java
    â”‚   â”‚   â”‚           â”‚   â”‚   â”œâ”€â”€ LogisticsController.java
    â”‚   â”‚   â”‚           â”‚   â”‚   â”œâ”€â”€ AfterSalesController.java
    â”‚   â”‚   â”‚           â”‚   â”‚   â””â”€â”€ ...
    â”‚   â”‚   â”‚           â”‚   â”œâ”€â”€ service/      # ä¸šåŠ¡é€»è¾‘å±‚
    â”‚   â”‚   â”‚           â”‚   â”œâ”€â”€ dao/          # æ•°æ®è®¿é—®å±‚
    â”‚   â”‚   â”‚           â”‚   â”œâ”€â”€ dto/          # æ•°æ®ä¼ è¾“å¯¹è±¡
    â”‚   â”‚   â”‚           â”‚   â””â”€â”€ model/        # æ•°æ®æ¨¡å‹
    â”‚   â”‚   â”‚           â””â”€â”€ util/             # å·¥å…·ç±»
    â”‚   â”‚   â”œâ”€â”€ resources/
    â”‚   â”‚   â”‚   â”œâ”€â”€ config.properties         # é…ç½®æ–‡ä»¶
    â”‚   â”‚   â”‚   â”œâ”€â”€ log4j2.xml               # æ—¥å¿—é…ç½®
    â”‚   â”‚   â”‚   â””â”€â”€ db.properties            # æ•°æ®åº“é…ç½®
    â”‚   â”‚   â””â”€â”€ webapp/                      # Webåº”ç”¨ç›®å½•
    â”‚   â”‚       â”œâ”€â”€ WEB-INF/
    â”‚   â”‚       â”‚   â”œâ”€â”€ web.xml              # Webé…ç½®
    â”‚   â”‚       â”‚   â””â”€â”€ classes/
    â”‚   â”‚       â”œâ”€â”€ index.jsp                 # è·³è½¬é¡µé¢
    â”‚   â”‚       â”œâ”€â”€ index.html                # Vueå…¥å£é¡µé¢
    â”‚   â”‚       â””â”€â”€ static/                   # Vueæ„å»ºçš„é™æ€èµ„æº
    â”‚   â”‚           â”œâ”€â”€ css/
    â”‚   â”‚           â”œâ”€â”€ js/
    â”‚   â”‚           â”œâ”€â”€ fonts/
    â”‚   â”‚           â””â”€â”€ img/
    â”‚   â””â”€â”€ test/
    â”‚       â””â”€â”€ java/
    â”œâ”€â”€ lib/                    # ç¬¬ä¸‰æ–¹ä¾èµ–åº“
    â”œâ”€â”€ pom.xml                # Mavené…ç½®
    â””â”€â”€ README.md
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Java**: JDK 17 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Tomcat**: Apache Tomcat 9.x
- **MySQL**: MySQL 8.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Node.js**: 16.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **Maven**: 3.6+ï¼ˆç”¨äºåç«¯æ„å»ºï¼‰

### 1. æ•°æ®åº“åˆå§‹åŒ–

```sql
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE apexflow CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºç”¨æˆ·å¹¶æˆæƒï¼ˆå¯é€‰ï¼‰
CREATE USER 'apexflow'@'localhost' IDENTIFIED BY 'apexflow123';
GRANT ALL PRIVILEGES ON apexflow.* TO 'apexflow'@'localhost';
FLUSH PRIVILEGES;

-- å¯¼å…¥è¡¨ç»“æ„ï¼ˆSQLæ–‡ä»¶ä½äº apexflow-server/src/main/resources/db/ï¼‰
-- mysql -u root -p apexflow < apexflow-server/src/main/resources/db/schema.sql
```

### 2. é…ç½®æ–‡ä»¶è®¾ç½®

**æ•°æ®åº“é…ç½®** (`apexflow-server/src/main/resources/db.properties`):

```properties
# æ•°æ®åº“è¿æ¥é…ç½®
db.driver=com.mysql.cj.jdbc.Driver
db.url=jdbc:mysql://localhost:3306/apexflow?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
db.username=root
db.password=yourpassword
db.initialSize=5
db.maxActive=20
db.maxWait=60000
```

### 3. é¡¹ç›®æ„å»ºä¸éƒ¨ç½²

#### æ–¹æ¡ˆä¸€ï¼šä¸€é”®æ„å»ºéƒ¨ç½²

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/yourusername/apexflow.git
cd apexflow

# 2. å®‰è£…å‰ç«¯ä¾èµ–å¹¶æ„å»º
cd apexflow-web
npm install
npm run build  # æ„å»ºåˆ°åç«¯é¡¹ç›®çš„webappç›®å½•

# 3. æ„å»ºåç«¯é¡¹ç›®
cd ../apexflow-server
mvn clean package

# 4. éƒ¨ç½²åˆ°Tomcat
# å°†target/apexflow.warå¤åˆ¶åˆ°Tomcatçš„webappsç›®å½•
cp target/apexflow.war /path/to/tomcat/webapps/

# 5. å¯åŠ¨Tomcat
/path/to/tomcat/bin/startup.sh
```

#### æ–¹æ¡ˆäºŒï¼šå¼€å‘æ¨¡å¼è¿è¡Œ

```bash
# 1. å¯åŠ¨åç«¯æœåŠ¡ï¼ˆåœ¨apexflow-serverç›®å½•ï¼‰
mvn tomcat7:run  # æˆ–ä½¿ç”¨IDEå¯åŠ¨

# 2. å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨ï¼ˆåœ¨apexflow-webç›®å½•ï¼‰
npm run serve

# 3. è®¿é—®åº”ç”¨
# å‰ç«¯å¼€å‘åœ°å€ï¼šhttp://localhost:3000
# åç«¯APIåœ°å€ï¼šhttp://localhost:8080
```

### 4. è®¿é—®ç³»ç»Ÿ

1. å¯åŠ¨TomcatæœåŠ¡å™¨
2. è®¿é—®åº”ç”¨åœ°å€ï¼šhttp://localhost:8080/apexflow
3. ä½¿ç”¨é»˜è®¤ç®¡ç†å‘˜è´¦å·ç™»å½•ï¼š
    - ç”¨æˆ·åï¼šadmin
    - å¯†ç ï¼šadmin123

## ğŸ”§ é…ç½®æ–‡ä»¶è¯´æ˜

### å‰ç«¯Vueé…ç½® (`apexflow-web/vue.config.js`)

```javascript
const path = require('path');

module.exports = {
  // æ„å»ºè¾“å‡ºåˆ°Javaé¡¹ç›®çš„webappç›®å½•
  outputDir: path.resolve(__dirname, '../apexflow-server/src/main/webapp'),
  
  // é™æ€èµ„æºè·¯å¾„ï¼ˆç›¸å¯¹è·¯å¾„ï¼Œé€‚åº”Tomcatéƒ¨ç½²ï¼‰
  publicPath: process.env.NODE_ENV === 'production' ? './' : '/',
  
  // å¼€å‘æœåŠ¡å™¨ä»£ç†é…ç½®
  devServer: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8080/apexflow',
        changeOrigin: true,
        pathRewrite: {
          '^/api': ''
        }
      }
    }
  },
  
  // ç”Ÿäº§ç¯å¢ƒé…ç½®
  productionSourceMap: false,
  css: {
    extract: true,
    sourceMap: false
  }
};
```

### Webåº”ç”¨é…ç½® (`apexflow-server/src/main/webapp/WEB-INF/web.xml`)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee 
         http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0">
    
    <display-name>ApexFlow</display-name>
    
    <!-- å­—ç¬¦ç¼–ç è¿‡æ»¤å™¨ -->
    <filter>
        <filter-name>encodingFilter</filter-name>
        <filter-class>org.apache.catalina.filters.SetCharacterEncodingFilter</filter-class>
        <init-param>
            <param-name>encoding</param-name>
            <param-value>UTF-8</param-value>
        </init-param>
    </filter>
    <filter-mapping>
        <filter-name>encodingFilter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>
    
    <!-- CORSè·¨åŸŸè¿‡æ»¤å™¨ -->
    <filter>
        <filter-name>corsFilter</filter-name>
        <filter-class>com.apex.config.CORSFilter</filter-class>
    </filter>
    <filter-mapping>
        <filter-name>corsFilter</filter-name>
        <url-pattern>/api/*</url-pattern>
    </filter-mapping>
    
    <!-- SPAåº”ç”¨è¿‡æ»¤å™¨ -->
    <filter>
        <filter-name>spaFilter</filter-name>
        <filter-class>com.apex.config.SpaFilter</filter-class>
    </filter>
    <filter-mapping>
        <filter-name>spaFilter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>
    
    <!-- é»˜è®¤é¦–é¡µ -->
    <welcome-file-list>
        <welcome-file>index.jsp</welcome-file>
        <welcome-file>index.html</welcome-file>
    </welcome-file-list>
    
    <!-- é”™è¯¯é¡µé¢é…ç½® -->
    <error-page>
        <error-code>404</error-code>
        <location>/index.html</location>
    </error-page>
    
    <session-config>
        <session-timeout>30</session-timeout>
    </session-config>
</web-app>
```

## ğŸ“Š æ•°æ®åº“è®¾è®¡

ä¸»è¦æ•°æ®è¡¨ç¤ºä¾‹ï¼š

```sql
-- è®¢å•è¡¨
CREATE TABLE `orders` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `order_no` VARCHAR(50) NOT NULL COMMENT 'è®¢å•å·',
  `customer_id` BIGINT COMMENT 'å®¢æˆ·ID',
  `total_amount` DECIMAL(10,2) NOT NULL COMMENT 'è®¢å•æ€»é‡‘é¢',
  `status` TINYINT NOT NULL DEFAULT 1 COMMENT 'è®¢å•çŠ¶æ€(1:å¾…ä»˜æ¬¾,2:å¾…å‘è´§,3:å·²å‘è´§,4:å·²å®Œæˆ,5:å·²å–æ¶ˆ)',
  `payment_status` TINYINT COMMENT 'æ”¯ä»˜çŠ¶æ€',
  `shipping_address` TEXT COMMENT 'æ”¶è´§åœ°å€',
  `created_at` DATETIME NOT NULL,
  `updated_at` DATETIME,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_order_no` (`order_no`),
  INDEX `idx_customer_id` (`customer_id`),
  INDEX `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è®¢å•è¡¨';

-- å•†å“è¡¨
CREATE TABLE `products` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `product_no` VARCHAR(50) NOT NULL COMMENT 'å•†å“ç¼–å·',
  `name` VARCHAR(200) NOT NULL COMMENT 'å•†å“åç§°',
  `category_id` BIGINT COMMENT 'åˆ†ç±»ID',
  `price` DECIMAL(10,2) NOT NULL COMMENT 'å•†å“ä»·æ ¼',
  `stock` INT NOT NULL DEFAULT 0 COMMENT 'åº“å­˜æ•°é‡',
  `status` TINYINT NOT NULL DEFAULT 1 COMMENT 'çŠ¶æ€(1:ä¸Šæ¶,2:ä¸‹æ¶)',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_product_no` (`product_no`),
  INDEX `idx_category_id` (`category_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å•†å“è¡¨';
```

å®Œæ•´æ•°æ®åº“è„šæœ¬è¯·æŸ¥çœ‹ `apexflow-server/src/main/resources/db/` ç›®å½•ã€‚

## ğŸ”Œ ç”¨æˆ·APIæ¥å£æ–‡æ¡£ï¼ˆç”¨æˆ·æ¨¡å—ï¼‰

åŸºäºç°æœ‰æ•°æ®åº“è¡¨ `apexflow_system_user` å®ç°å››ä¸ªAPIï¼Œä¸åˆ›å»ºæ–°è¡¨ï¼Œä¸è¿”å›å†—ä½™ä¿¡æ¯ã€‚

### 1. ç”¨æˆ·ç™»å½•
**POST** `/api/auth/login`

#### æµç¨‹
```
å®¢æˆ·ç«¯ (HTTPS) â†’ åç«¯æ¥æ”¶æ˜æ–‡å¯†ç  â†’ æŸ¥è¯¢ç”¨æˆ· â†’ åŠ ç›å“ˆå¸ŒéªŒè¯ â†’ è¿”å›Token
```

#### è¯·æ±‚
```json
{
  "username": "admin",
  "password": "your_password"
}
```

#### æˆåŠŸå“åº”
```json
{
  "success": true,
  "data": {
    "token": "jwt_token_here",
    "user": {
      "id": 1,
      "username": "admin",
      "realName": "ç³»ç»Ÿç®¡ç†å‘˜",
      "isAdmin": true
    }
  }
}
```

#### å¤±è´¥å“åº”
```json
{
  "success": false,
  "message": "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"
}
```

---

### 2. è·å–ç”¨æˆ·æƒé™
**GET** `/api/user/permissions`

#### æµç¨‹
```
å®¢æˆ·ç«¯å¸¦Token â†’ TokenéªŒè¯ â†’ æŸ¥è¯¢æ•°æ®åº“ â†’ è¿”å›æƒé™å­—æ®µ
```

#### è¯·æ±‚å¤´
```
Authorization: Bearer jwt_token_here
```

#### å“åº”
```json
{
  "success": true,
  "data": {
    "isAdmin": true,
    "canManageOrder": true,
    "canManageLogistics": true,
    "canManageAfterSales": true,
    "canManageReview": true,
    "canManageInventory": true,
    "canManageIncome": true
  }
}
```

---

### 3. ä¿®æ”¹ä¸ªäººä¿¡æ¯
**PUT** `/api/user/profile`

#### æµç¨‹
```
å®¢æˆ·ç«¯å¸¦Tokenå’Œæ›´æ–°æ•°æ® â†’ TokenéªŒè¯ â†’ æ•°æ®éªŒè¯ â†’ æ›´æ–°æ•°æ®åº“
```

#### è¯·æ±‚
```json
{
  "realName": "æ–°å§“å",
  "email": "new@email.com",
  "phone": "13800138001"
}
```
*è‡³å°‘æä¾›ä¸€ä¸ªå­—æ®µ*

#### å“åº”
```json
{
  "success": true,
  "data": {
    "id": 1,
    "realName": "æ–°å§“å",
    "email": "new@email.com",
    "phone": "13800138001"
  }
}
```

---

### 4. ç”¨æˆ·ç™»å‡º
**POST** `/api/auth/logout`

#### æµç¨‹
```
å®¢æˆ·ç«¯å¸¦Token â†’ TokenéªŒè¯ â†’ å®¢æˆ·ç«¯ä¸¢å¼ƒTokenï¼ˆæ— çŠ¶æ€å®ç°ï¼‰
```

#### å“åº”
```json
{
  "success": true
}
```

## ğŸ”Œ APIæ¥å£æ–‡æ¡£ï¼ˆè´¢åŠ¡æ”¶æ”¯æ¨¡å—ï¼‰

### 1. åˆ›å»ºè´¢åŠ¡è®°å½•
**POST** `/api/income`

#### æµç¨‹
```
å®¢æˆ·ç«¯ (HTTPS) â†’ éªŒè¯Token â†’ éªŒè¯è¾“å…¥æ•°æ® â†’ åˆ›å»ºè´¢åŠ¡è®°å½• â†’ è¿”å›åˆ›å»ºç»“æœ
```

#### è¯·æ±‚å¤´
```
Authorization: Bearer jwt_token_here
Content-Type: application/json
```

#### è¯·æ±‚
```json
{
  "orderId": "ORDER20231201001",
  "type": "income",
  "amount": 7999.00,
  "paymentMethod": "alipay",
  "status": 2,
  "transactionTime": "2023-12-01 09:05:00",
  "remark": "iPhone 14 Proé”€å”®æ¬¾"
}
```

#### æˆåŠŸå“åº”
```json
{
  "success": true,
  "message": "è´¢åŠ¡è®°å½•åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 1,
    "orderId": "ORDER20231201001",
    "type": "income",
    "amount": 7999.00,
    "paymentMethod": "alipay",
    "status": 2,
    "transactionTime": "2023-12-01 09:05:00",
    "remark": "iPhone 14 Proé”€å”®æ¬¾"
  }
}
```

#### å¤±è´¥å“åº”
```json
{
  "success": false,
  "message": "è¾“å…¥æ•°æ®éªŒè¯å¤±è´¥",
  "data": {
    "orderId": "è®¢å•å·ä¸èƒ½ä¸ºç©º"
  }
}
```

**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æˆ–è´¢åŠ¡ç®¡ç†æƒé™

---

### 2. è·å–è´¢åŠ¡è®°å½•è¯¦æƒ…
**GET** `/api/income/{id}`

#### æµç¨‹
```
å®¢æˆ·ç«¯ â†’ éªŒè¯Token â†’ æŸ¥è¯¢æ•°æ®åº“ â†’ è¿”å›è®°å½•è¯¦æƒ…
```

#### è¯·æ±‚å¤´
```
Authorization: Bearer jwt_token_here
```

#### å“åº”
```json
{
  "success": true,
  "message": "è´¢åŠ¡è®°å½•è¯¦æƒ…è·å–æˆåŠŸ",
  "data": {
    "id": 1,
    "orderId": "ORDER20231201001",
    "type": "income",
    "amount": 7999.00,
    "paymentMethod": "alipay",
    "status": 2,
    "transactionTime": "2023-12-01 09:05:00",
    "remark": "iPhone 14 Proé”€å”®æ¬¾"
  }
}
```

**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æˆ–è´¢åŠ¡ç®¡ç†æƒé™

---

### 3. è·å–è´¢åŠ¡è®°å½•åˆ—è¡¨
**GET** `/api/income/list?page=1&pageSize=20&type=income&status=2`

#### æŸ¥è¯¢å‚æ•°
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `pageSize`: æ¯é¡µè®°å½•æ•°ï¼ˆé»˜è®¤20ï¼Œæœ€å¤§100ï¼‰
- `type`: è´¢åŠ¡ç±»å‹ï¼ˆincome/refundï¼‰
- `status`: çŠ¶æ€ï¼ˆ1-å¾…å…¥è´¦ï¼Œ2-å·²å…¥è´¦ï¼‰

#### æµç¨‹
```
å®¢æˆ·ç«¯ â†’ éªŒè¯Token â†’ æŸ¥è¯¢æ•°æ®åº“ â†’ è¿”å›åˆ†é¡µåˆ—è¡¨
```

#### å“åº”
```json
{
  "success": true,
  "message": "è´¢åŠ¡è®°å½•åˆ—è¡¨è·å–æˆåŠŸ",
  "data": {
    "incomes": [
      {
        "id": 1,
        "orderId": "ORDER20231201001",
        "type": "income",
        "amount": 7999.00,
        "paymentMethod": "alipay",
        "status": 2,
        "transactionTime": "2023-12-01 09:05:00",
        "remark": "iPhone 14 Proé”€å”®æ¬¾"
      }
    ],
    "currentPage": 1,
    "pageSize": 20,
    "totalIncome": 150000.00,
    "totalRefund": 5000.00,
    "netIncome": 145000.00
  }
}
```

**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æˆ–è´¢åŠ¡ç®¡ç†æƒé™

---

### 4. æ›´æ–°è´¢åŠ¡è®°å½•
**PUT** `/api/income/{id}`

#### æµç¨‹
```
å®¢æˆ·ç«¯ â†’ éªŒè¯Token â†’ æ£€æŸ¥è®°å½•å­˜åœ¨ â†’ æ›´æ–°è®°å½• â†’ è¿”å›æ›´æ–°ç»“æœ
```

#### è¯·æ±‚
```json
{
  "amount": 8500.00,
  "status": 2,
  "remark": "æ›´æ–°åçš„å¤‡æ³¨"
}
```

#### å“åº”
```json
{
  "success": true,
  "message": "è´¢åŠ¡è®°å½•æ›´æ–°æˆåŠŸ",
  "data": {
    "id": 1,
    "orderId": "ORDER20231201001",
    "type": "income",
    "amount": 8500.00,
    "paymentMethod": "alipay",
    "status": 2,
    "transactionTime": "2023-12-01 09:05:00",
    "remark": "æ›´æ–°åçš„å¤‡æ³¨"
  }
}
```

**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æˆ–è´¢åŠ¡ç®¡ç†æƒé™

---

### 5. åˆ é™¤è´¢åŠ¡è®°å½•
**DELETE** `/api/income/{id}`

#### æµç¨‹
```
å®¢æˆ·ç«¯ â†’ éªŒè¯Token â†’ æ£€æŸ¥è®°å½•å­˜åœ¨ â†’ åˆ é™¤è®°å½• â†’ è¿”å›åˆ é™¤ç»“æœ
```

#### å“åº”
```json
{
  "success": true,
  "message": "è´¢åŠ¡è®°å½•åˆ é™¤æˆåŠŸ"
}
```

**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æˆ–è´¢åŠ¡ç®¡ç†æƒé™

---

### 6. æ›´æ–°è´¢åŠ¡çŠ¶æ€
**PUT** `/api/income/{id}/status`

#### æµç¨‹
```
å®¢æˆ·ç«¯ â†’ éªŒè¯Token â†’ éªŒè¯çŠ¶æ€å€¼ â†’ æ›´æ–°çŠ¶æ€ â†’ è¿”å›ç»“æœ
```

#### è¯·æ±‚
```json
{
  "status": 2
}
```

#### å“åº”
```json
{
  "success": true,
  "message": "è´¢åŠ¡çŠ¶æ€æ›´æ–°æˆåŠŸ"
}
```

**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æˆ–è´¢åŠ¡ç®¡ç†æƒé™

---

### 7. è·å–è´¢åŠ¡ç»Ÿè®¡
**GET** `/api/income/statistics`

#### æµç¨‹
```
å®¢æˆ·ç«¯ â†’ éªŒè¯Token â†’ æŸ¥è¯¢ç»Ÿè®¡ä¿¡æ¯ â†’ è¿”å›ç»Ÿè®¡æ•°æ®
```

#### å“åº”
```json
{
  "success": true,
  "message": "è´¢åŠ¡ç»Ÿè®¡è·å–æˆåŠŸ",
  "data": {
    "totalIncome": 150000.00,
    "totalRefund": 5000.00,
    "netIncome": 145000.00
  }
}
```

**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æˆ–è´¢åŠ¡ç®¡ç†æƒé™

---

### 8. æ ¹æ®è®¢å•å·æŸ¥è¯¢è´¢åŠ¡è®°å½•
**GET** `/api/income/order/{orderId}`

#### æµç¨‹
```
å®¢æˆ·ç«¯ â†’ éªŒè¯Token â†’ æŸ¥è¯¢è®¢å•ç›¸å…³è®°å½• â†’ è¿”å›è®°å½•åˆ—è¡¨
```

#### å“åº”
```json
{
  "success": true,
  "message": "è®¢å•è´¢åŠ¡è®°å½•è·å–æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "orderId": "ORDER20231201001",
      "type": "income",
      "amount": 7999.00,
      "paymentMethod": "alipay",
      "status": 2,
      "transactionTime": "2023-12-01 09:05:00",
      "remark": "iPhone 14 Proé”€å”®æ¬¾"
    }
  ]
}
```

**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æˆ–è´¢åŠ¡ç®¡ç†æƒé™

### ğŸ” æƒé™æ§åˆ¶

æ‰€æœ‰è´¢åŠ¡ç›¸å…³APIå‡ä½¿ç”¨`@RequirePermission`æ³¨è§£è¿›è¡Œæƒé™éªŒè¯ï¼Œéœ€è¦ä»¥ä¸‹ä»»æ„ä¸€ç§æƒé™ï¼š
- ç®¡ç†å‘˜æƒé™ (`Permission.ADMIN`)
- è´¢åŠ¡ç®¡ç†æƒé™ (`Permission.INCOME_MANAGE`)

æƒé™éªŒè¯é€»è¾‘ä¸ºORï¼ˆä»»æ„æ»¡è¶³ä¸€ä¸ªå³å¯ï¼‰ï¼Œé€šè¿‡`RequirePermission.LogicType.OR`é…ç½®ã€‚

### ğŸ“Š æ•°æ®åº“å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | INT | è´¢åŠ¡è®°å½•IDï¼Œä¸»é”® |
| order_id | VARCHAR(50) | å…³è”è®¢å•å· |
| type | VARCHAR(20) | ç±»å‹ï¼šincome-æ”¶å…¥ï¼Œrefund-é€€æ¬¾ |
| amount | DECIMAL(10,2) | é‡‘é¢ï¼ˆæ­£æ•°ä¸ºæ”¶å…¥ï¼Œè´Ÿæ•°ä¸ºé€€æ¬¾ï¼‰ |
| payment_method | VARCHAR(20) | æ”¯ä»˜æ–¹å¼ |
| status | TINYINT | çŠ¶æ€ï¼š1-å¾…å…¥è´¦ï¼Œ2-å·²å…¥è´¦ |
| transaction_time | DATETIME | äº¤æ˜“æ—¶é—´ |
| remark | VARCHAR(200) | å¤‡æ³¨ |


## ğŸ”Œ è¯„ä»·ç®¡ç†APIæ–‡æ¡£ï¼ˆè¯„ä»·ç®¡ç†æ¨¡å—ï¼‰

### 1. åˆ›å»ºè¯„ä»·
**POST** `/api/review`

#### æµç¨‹
```
å®¢æˆ·ç«¯ â†’ éªŒè¯Tokenå’Œæƒé™ â†’ éªŒè¯è¯·æ±‚æ•°æ® â†’ åˆ›å»ºè¯„ä»· â†’ è¿”å›ç»“æœ
```

### æƒé™è¦æ±‚
- ç®¡ç†å‘˜æƒé™ (`Permission.ADMIN`)
- è®¢å•ç®¡ç†æƒé™ (`Permission.ORDER_MANAGE`)

### è¯·æ±‚ç¤ºä¾‹
```json
{
  "orderId": "ORDER20231201001",
  "productId": 1,
  "userId": 1001,
  "rating": 5,
  "content": "å•†å“è´¨é‡å¾ˆå¥½ï¼Œç‰©æµå¾ˆå¿«",
  "images": "image1.jpg,image2.jpg",
  "anonymous": false
}
```

### æˆåŠŸå“åº”
```json
{
  "success": true,
  "message": "è¯„ä»·åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 101,
    "orderId": "ORDER20231201001",
    "productId": 1,
    "userId": 1001,
    "rating": 5,
    "content": "å•†å“è´¨é‡å¾ˆå¥½ï¼Œç‰©æµå¾ˆå¿«",
    "images": "image1.jpg,image2.jpg",
    "anonymous": false,
    "createdAt": "2023-12-01T10:30:00"
  }
}
```

### å¤±è´¥å“åº”
```json
{
  "success": false,
  "message": "è¯¥è®¢å•å·²è¯„ä»·",
  "errorCode": "REVIEW_EXISTS"
}
```

---

### 2. è·å–è¯„ä»·åˆ—è¡¨
**GET** `/api/review?productId=1&page=1&pageSize=20`

### æµç¨‹
```
å®¢æˆ·ç«¯ â†’ éªŒè¯Tokenå’Œæƒé™ â†’ æŸ¥è¯¢æ•°æ®åº“ â†’ è¿”å›åˆ†é¡µåˆ—è¡¨
```

### æŸ¥è¯¢å‚æ•°
- `productId` (å¯é€‰): å•†å“ID
- `userId` (å¯é€‰): ç”¨æˆ·ID
- `page` (å¯é€‰, é»˜è®¤1): é¡µç 
- `pageSize` (å¯é€‰, é»˜è®¤20, æœ€å¤§100): æ¯é¡µæ•°é‡

### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "reviews": [
      {
        "id": 101,
        "orderId": "ORDER20231201001",
        "productId": 1,
        "userId": 1001,
        "rating": 5,
        "content": "å•†å“è´¨é‡å¾ˆå¥½",
        "images": "image1.jpg",
        "anonymous": false,
        "createdAt": "2023-12-01T10:30:00"
      }
    ],
    "total": 50,
    "page": 1,
    "pageSize": 20
  }
}
```

---

### 3. è·å–è¯„ä»·è¯¦æƒ…
**GET** `/api/review/{id}`

### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "id": 101,
    "orderId": "ORDER20231201001",
    "productId": 1,
    "userId": 1001,
    "rating": 5,
    "content": "å•†å“è´¨é‡å¾ˆå¥½",
    "images": "image1.jpg",
    "anonymous": false,
    "createdAt": "2023-12-01T10:30:00"
  }
}
```

---

### 4. è·å–è¯„ä»·ç»Ÿè®¡
**GET** `/api/review/stats/{productId}`

### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "averageRating": 4.5,
    "totalReviews": 120,
    "distribution": {
      "rating1": 5,
      "rating2": 10,
      "rating3": 15,
      "rating4": 40,
      "rating5": 50
    }
  }
}
```

---

### 5. åˆ é™¤è¯„ä»·
**DELETE** `/api/review/{id}`

### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "åˆ é™¤æˆåŠŸ",
  "data": null
}
```

---

### ğŸ” æƒé™æ§åˆ¶

æ‰€æœ‰APIå‡ä½¿ç”¨`@RequirePermission`æ³¨è§£è¿›è¡Œæƒé™éªŒè¯ï¼Œéœ€è¦ä»¥ä¸‹ä»»æ„ä¸€ç§æƒé™ï¼š
- ç®¡ç†å‘˜æƒé™ (`Permission.ADMIN`)
- è®¢å•ç®¡ç†æƒé™ (`Permission.ORDER_MANAGE`)

æƒé™éªŒè¯é€»è¾‘ä¸ºORï¼ˆä»»æ„æ»¡è¶³ä¸€ä¸ªå³å¯ï¼‰ï¼Œé€šè¿‡`RequirePermission.LogicType.OR`é…ç½®ã€‚

---

### ğŸ“Š æ•°æ®åº“è¡¨è¯´æ˜

ä½¿ç”¨ç°æœ‰è¡¨ `apexflow_review`ï¼š
```sql
CREATE TABLE apexflow_review (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'è¯„ä»·ID',
    order_id VARCHAR(50) NOT NULL COMMENT 'å…³è”è®¢å•å·',
    product_id INT NOT NULL COMMENT 'å•†å“ID',
    user_id INT NOT NULL COMMENT 'è¯„ä»·ç”¨æˆ·ID',
    rating TINYINT NOT NULL COMMENT 'è¯„åˆ†ï¼š1-5æ˜Ÿ',
    content TEXT COMMENT 'è¯„ä»·å†…å®¹',
    images TEXT COMMENT 'è¯„ä»·å›¾ç‰‡URLï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”',
    is_anonymous BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦åŒ¿åè¯„ä»·',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'è¯„ä»·æ—¶é—´'
) COMMENT='å•†å“è¯„ä»·è¡¨';
```

## ğŸ”Œ APIæ¥å£æ–‡æ¡£ï¼ˆè®¢å•ç®¡ç†æ¨¡å—ï¼‰

### 1. åˆ›å»ºè®¢å•
**POST** `/api/orders`

#### æµç¨‹
```
å®¢æˆ·ç«¯ (HTTPS) â†’ éªŒè¯Token â†’ éªŒè¯è¾“å…¥æ•°æ® â†’ åˆ›å»ºè®¢å•ä¸»ä¿¡æ¯å’Œè®¢å•é¡¹ â†’ è¿”å›åˆ›å»ºç»“æœ
```

#### è¯·æ±‚å¤´
```
Authorization: Bearer jwt_token_here
Content-Type: application/json
```

#### è¯·æ±‚ç¤ºä¾‹
```json
{
  "userId": 1001,
  "totalAmount": 7999.00,
  "paymentMethod": "alipay",
  "addressId": 123,
  "orderItems": [
    {
      "productId": 1,
      "productName": "iPhone 14 Pro",
      "quantity": 1,
      "price": 7999.00,
      "subtotal": 7999.00
    }
  ]
}
```

#### æˆåŠŸå“åº”
```json
{
  "success": true,
  "message": "è®¢å•åˆ›å»ºæˆåŠŸ",
  "data": {
    "orderId": "ORDER1701234567890",
    "totalAmount": 7999.00,
    "status": 1,
    "createdAt": "2023-12-01T09:00:00"
  }
}
```

#### å¤±è´¥å“åº”
```json
{
  "success": false,
  "message": "ç”¨æˆ·IDã€æ€»é‡‘é¢å’Œè®¢å•é¡¹ä¸èƒ½ä¸ºç©º"
}
```

**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æˆ–è®¢å•ç®¡ç†æƒé™

---

### 2. è·å–è®¢å•è¯¦æƒ…
**GET** `/api/orders/{orderId}`

#### æµç¨‹
```
å®¢æˆ·ç«¯ â†’ éªŒè¯Token â†’ æŸ¥è¯¢æ•°æ®åº“ â†’ è¿”å›è®¢å•è¯¦æƒ…
```

#### è¯·æ±‚å¤´
```
Authorization: Bearer jwt_token_here
```

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "è®¢å•è¯¦æƒ…è·å–æˆåŠŸ",
  "data": {
    "orderId": "ORDER20231201001",
    "userId": 1001,
    "totalAmount": 7999.00,
    "status": 4,
    "paymentMethod": "alipay",
    "addressId": 123,
    "createdAt": "2023-12-01T09:00:00",
    "paidAt": "2023-12-01T09:05:00",
    "shippedAt": "2023-12-01T14:00:00",
    "completedAt": "2023-12-03T10:00:00",
    "orderItems": [
      {
        "id": 1,
        "orderId": "ORDER20231201001",
        "productId": 1,
        "productName": "iPhone 14 Pro",
        "quantity": 1,
        "price": 7999.00,
        "subtotal": 7999.00
      }
    ]
  }
}
```

**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æˆ–è®¢å•ç®¡ç†æƒé™

---

### 3. è·å–è®¢å•åˆ—è¡¨
**GET** `/api/orders/list?page=1&pageSize=20&userId=1001&status=4`

#### æŸ¥è¯¢å‚æ•°
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `pageSize`: æ¯é¡µè®°å½•æ•°ï¼ˆé»˜è®¤20ï¼Œæœ€å¤§100ï¼‰
- `userId`: ç”¨æˆ·IDï¼ˆå¯é€‰ï¼‰
- `status`: è®¢å•çŠ¶æ€ï¼ˆå¯é€‰ï¼Œ1-å¾…æ”¯ä»˜ï¼Œ2-å·²æ”¯ä»˜ï¼Œ3-å·²å‘è´§ï¼Œ4-å·²å®Œæˆï¼Œ5-å·²å–æ¶ˆï¼‰

#### æµç¨‹
```
å®¢æˆ·ç«¯ â†’ éªŒè¯Token â†’ æŸ¥è¯¢æ•°æ®åº“ â†’ è¿”å›åˆ†é¡µåˆ—è¡¨
```

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "è®¢å•åˆ—è¡¨è·å–æˆåŠŸ",
  "data": {
    "orders": [
      {
        "orderId": "ORDER20231201001",
        "userId": 1001,
        "totalAmount": 7999.00,
        "status": 4,
        "paymentMethod": "alipay",
        "createdAt": "2023-12-01T09:00:00"
      }
    ],
    "currentPage": 1,
    "pageSize": 20,
    "totalCount": 50,
    "totalPages": 3
  }
}
```

**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æˆ–è®¢å•ç®¡ç†æƒé™

---

### 4. æ›´æ–°è®¢å•ä¿¡æ¯
**PUT** `/api/orders/{orderId}`

#### æµç¨‹
```
å®¢æˆ·ç«¯ â†’ éªŒè¯Token â†’ æ£€æŸ¥è®¢å•å­˜åœ¨ â†’ æ›´æ–°è®¢å•ä¿¡æ¯ â†’ è¿”å›æ›´æ–°ç»“æœ
```

#### è¯·æ±‚ç¤ºä¾‹
```json
{
  "addressId": 124,
  "paymentMethod": "wxpay"
}
```

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "è®¢å•ä¿¡æ¯æ›´æ–°æˆåŠŸ"
}
```

**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æˆ–è®¢å•ç®¡ç†æƒé™

---

### 5. åˆ é™¤è®¢å•
**DELETE** `/api/orders/{orderId}`

#### æµç¨‹
```
å®¢æˆ·ç«¯ â†’ éªŒè¯Token â†’ æ£€æŸ¥è®¢å•å­˜åœ¨ â†’ çº§è”åˆ é™¤è®¢å•åŠç›¸å…³è®°å½• â†’ è¿”å›åˆ é™¤ç»“æœ
```

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "è®¢å•åˆ é™¤æˆåŠŸ"
}
```

**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æˆ–è®¢å•ç®¡ç†æƒé™

---

### 6. æ›´æ–°è®¢å•çŠ¶æ€
**PUT** `/api/orders/{orderId}/status`

#### æµç¨‹
```
å®¢æˆ·ç«¯ â†’ éªŒè¯Token â†’ éªŒè¯çŠ¶æ€å€¼ â†’ æ›´æ–°çŠ¶æ€ â†’ è¿”å›ç»“æœ
```

#### è¯·æ±‚ç¤ºä¾‹
```json
{
  "status": 2
}
```

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "è®¢å•çŠ¶æ€æ›´æ–°æˆåŠŸ"
}
```

**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æˆ–è®¢å•ç®¡ç†æƒé™

### ğŸ“Š è®¢å•çŠ¶æ€è¯´æ˜
| çŠ¶æ€ç  | çŠ¶æ€è¯´æ˜ | å…è®¸çš„æ“ä½œ |
|--------|----------|------------|
| 1 | å¾…æ”¯ä»˜ | æ›´æ–°è®¢å•ä¿¡æ¯ã€åˆ é™¤è®¢å•ã€æ›´æ–°çŠ¶æ€ä¸º2æˆ–5 |
| 2 | å·²æ”¯ä»˜ | æ›´æ–°è®¢å•ä¿¡æ¯ã€åˆ é™¤è®¢å•ã€æ›´æ–°çŠ¶æ€ä¸º3æˆ–5 |
| 3 | å·²å‘è´§ | æ›´æ–°çŠ¶æ€ä¸º4 |
| 4 | å·²å®Œæˆ | æ— çŠ¶æ€æ›´æ–°æ“ä½œ |
| 5 | å·²å–æ¶ˆ | æ— çŠ¶æ€æ›´æ–°æ“ä½œ |

### ğŸ” æƒé™æ§åˆ¶
æ‰€æœ‰è®¢å•ç›¸å…³APIå‡ä½¿ç”¨`@RequirePermission`æ³¨è§£è¿›è¡Œæƒé™éªŒè¯ï¼Œéœ€è¦ä»¥ä¸‹ä»»æ„ä¸€ç§æƒé™ï¼š
- ç®¡ç†å‘˜æƒé™ (`Permission.ADMIN`)
- è®¢å•ç®¡ç†æƒé™ (`Permission.ORDER_MANAGE`)

æƒé™éªŒè¯é€»è¾‘ä¸ºORï¼ˆä»»æ„æ»¡è¶³ä¸€ä¸ªå³å¯ï¼‰ï¼Œé€šè¿‡`RequirePermission.LogicType.OR`é…ç½®ã€‚

---

## ğŸ”Œ !!!! *ç®¡ç†å‘˜ç®¡ç†æ¨¡å— API æ–‡æ¡£*ï¼ˆç³»ç»Ÿè®¾ç½®æ¨¡å—ï¼‰

### 1. è·å–ç”¨æˆ·åˆ—è¡¨
**GET** `/api/admin/users`

#### æµç¨‹
```
å®¢æˆ·ç«¯å¸¦Token â†’ TokenéªŒè¯ â†’ ç®¡ç†å‘˜æƒé™éªŒè¯ â†’ æŸ¥è¯¢æ•°æ®åº“ â†’ è¿”å›åˆ†é¡µç”¨æˆ·åˆ—è¡¨
```

#### æŸ¥è¯¢å‚æ•°
- `page` (å¯é€‰, é»˜è®¤1): é¡µç ï¼ˆä»1å¼€å§‹ï¼‰
- `pageSize` (å¯é€‰, é»˜è®¤20, æœ€å¤§100): æ¯é¡µè®°å½•æ•°

#### è¯·æ±‚å¤´
```
Authorization: Bearer jwt_token_here
```

#### æˆåŠŸå“åº”
```json
{
  "success": true,
  "message": "è·å–ç”¨æˆ·åˆ—è¡¨æˆåŠŸ",
  "data": {
    "users": [
      {
        "id": 1,
        "username": "admin",
        "realName": "ç³»ç»Ÿç®¡ç†å‘˜",
        "email": "admin@apexflow.com",
        "phone": "13800138000",
        "isAdmin": true,
        "canManageOrder": true,
        "canManageLogistics": true,
        "canManageAfterSales": true,
        "canManageReview": true,
        "canManageInventory": true,
        "canManageIncome": true,
        "status": 1,
        "createdAt": "2023-12-01T09:00:00",
        "updatedAt": "2023-12-01T09:00:00",
        "lastLoginAt": "2023-12-01T10:30:00"
      }
    ],
    "currentPage": 1,
    "pageSize": 20,
    "totalCount": 50,
    "totalPages": 3
  }
}
```

#### å¤±è´¥å“åº”
```json
{
  "success": false,
  "message": "éœ€è¦ç®¡ç†å‘˜æƒé™"
}
```

**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™ (`Permission.ADMIN`)

---

### 2. æœç´¢ç”¨æˆ·
**GET** `/api/admin/users/search`

#### æµç¨‹
```
å®¢æˆ·ç«¯å¸¦Token â†’ TokenéªŒè¯ â†’ ç®¡ç†å‘˜æƒé™éªŒè¯ â†’ æ¨¡ç³Šæœç´¢æ•°æ®åº“ â†’ è¿”å›æœç´¢ç»“æœ
```

#### æŸ¥è¯¢å‚æ•°
- `keyword` (å¿…éœ€): æœç´¢å…³é”®è¯ï¼ˆç”¨æˆ·åã€çœŸå®å§“åã€é‚®ç®±ã€ç”µè¯ï¼‰
- `page` (å¯é€‰, é»˜è®¤1): é¡µç 
- `pageSize` (å¯é€‰, é»˜è®¤20): æ¯é¡µè®°å½•æ•°

#### è¯·æ±‚å¤´
```
Authorization: Bearer jwt_token_here
```

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "æœç´¢ç”¨æˆ·æˆåŠŸ",
  "data": {
    "users": [
      {
        "id": 2,
        "username": "user1",
        "realName": "å¼ ä¸‰",
        "email": "zhangsan@example.com",
        "phone": "13800138001",
        "isAdmin": false,
        "canManageOrder": true,
        "canManageLogistics": false,
        "canManageAfterSales": false,
        "canManageReview": false,
        "canManageInventory": false,
        "canManageIncome": false,
        "status": 1,
        "createdAt": "2023-12-01T09:00:00",
        "updatedAt": "2023-12-01T09:00:00",
        "lastLoginAt": "2023-12-01T10:30:00"
      }
    ],
    "currentPage": 1,
    "pageSize": 20,
    "totalCount": 1,
    "totalPages": 1
  }
}
```

**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™ (`Permission.ADMIN`)

---

### 3. æ›´æ–°ç”¨æˆ·ä¿¡æ¯
**PUT** `/api/admin/users/{id}`

#### æµç¨‹
```
å®¢æˆ·ç«¯å¸¦Tokenå’Œæ›´æ–°æ•°æ® â†’ TokenéªŒè¯ â†’ ç®¡ç†å‘˜æƒé™éªŒè¯ â†’ éªŒè¯è¾“å…¥æ•°æ® â†’ æ›´æ–°æ•°æ®åº“
```

#### è¯·æ±‚å¤´
```
Authorization: Bearer jwt_token_here
Content-Type: application/json
```

#### è¯·æ±‚ç¤ºä¾‹
```json
{
  "realName": "æå››",
  "email": "lisi@example.com",
  "phone": "13800138002",
  "status": 1
}
```

*è‡³å°‘æä¾›ä¸€ä¸ªå­—æ®µ*

### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "æ›´æ–°ç”¨æˆ·ä¿¡æ¯æˆåŠŸ",
  "data": {
    "id": 2,
    "username": "user1",
    "realName": "æå››",
    "email": "lisi@example.com",
    "phone": "13800138002",
    "isAdmin": false,
    "canManageOrder": true,
    "canManageLogistics": false,
    "canManageAfterSales": false,
    "canManageReview": false,
    "canManageInventory": false,
    "canManageIncome": false,
    "status": 1,
    "createdAt": "2023-12-01T09:00:00",
    "updatedAt": "2023-12-02T10:30:00",
    "lastLoginAt": "2023-12-01T10:30:00"
  }
}
```

#### å¤±è´¥å“åº”
```json
{
  "success": false,
  "message": "é‚®ç®±å·²è¢«å…¶ä»–ç”¨æˆ·ä½¿ç”¨"
}
```

**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™ (`Permission.ADMIN`)

---

### 4. æ›´æ–°ç”¨æˆ·æƒé™
**PUT** `/api/admin/users/{id}/permissions`

#### æµç¨‹
```
å®¢æˆ·ç«¯å¸¦Tokenå’Œæƒé™æ•°æ® â†’ TokenéªŒè¯ â†’ ç®¡ç†å‘˜æƒé™éªŒè¯ â†’ æ›´æ–°æƒé™å­—æ®µ â†’ è¿”å›æ›´æ–°ç»“æœ
```

#### è¯·æ±‚å¤´
```
Authorization: Bearer jwt_token_here
Content-Type: application/json
```

#### è¯·æ±‚ç¤ºä¾‹
```json
{
  "isAdmin": false,
  "canManageOrder": true,
  "canManageLogistics": true,
  "canManageAfterSales": false,
  "canManageReview": false,
  "canManageInventory": true,
  "canManageIncome": false
}
```

*è‡³å°‘æä¾›ä¸€ä¸ªæƒé™å­—æ®µ*

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "æ›´æ–°ç”¨æˆ·æƒé™æˆåŠŸ",
  "data": {
    "userId": 2,
    "isAdmin": false,
    "canManageOrder": true,
    "canManageLogistics": true,
    "canManageAfterSales": false,
    "canManageReview": false,
    "canManageInventory": true,
    "canManageIncome": false
  }
}
```

**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™ (`Permission.ADMIN`)

---

### 5. é‡ç½®ç”¨æˆ·å¯†ç 
**PUT** `/api/admin/users/{id}/password`

#### æµç¨‹
```
å®¢æˆ·ç«¯å¸¦Tokenå’Œæ–°å¯†ç  â†’ TokenéªŒè¯ â†’ ç®¡ç†å‘˜æƒé™éªŒè¯ â†’ å¯†ç å¼ºåº¦éªŒè¯ â†’ ç”Ÿæˆæ–°ç›å“ˆå¸Œ â†’ æ›´æ–°æ•°æ®åº“
```

#### è¯·æ±‚å¤´
```
Authorization: Bearer jwt_token_here
Content-Type: application/json
```

#### è¯·æ±‚ç¤ºä¾‹
```json
{
  "newPassword": "newpassword123"
}
```

*å¯†ç é•¿åº¦è‡³å°‘6ä½*

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "é‡ç½®å¯†ç æˆåŠŸ",
  "data": {
    "success": true,
    "message": "å¯†ç é‡ç½®æˆåŠŸ",
    "userId": 2
  }
}
```

#### å¤±è´¥å“åº”
```json
{
  "success": false,
  "message": "å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½"
}
```

**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™ (`Permission.ADMIN`)

---

### ğŸ“Š ç”¨æˆ·çŠ¶æ€è¯´æ˜
| çŠ¶æ€ç  | çŠ¶æ€è¯´æ˜ |
|--------|----------|
| 1 | æ­£å¸¸ |
| 0 | ç¦ç”¨ |

### ğŸ” æƒé™æ§åˆ¶
æ‰€æœ‰ç®¡ç†å‘˜APIå‡ä½¿ç”¨`@RequirePermission`æ³¨è§£è¿›è¡Œæƒé™éªŒè¯ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™ï¼š
- ç®¡ç†å‘˜æƒé™ (`Permission.ADMIN`)

æƒé™éªŒè¯é€»è¾‘ä¸ºORï¼ˆä»»æ„æ»¡è¶³ä¸€ä¸ªå³å¯ï¼‰ï¼Œé€šè¿‡`RequirePermission.LogicType.OR`é…ç½®ã€‚

---



## ğŸ”Œ å”®åæœåŠ¡APIæ–‡æ¡£ï¼ˆå”®åç®¡ç†æ¨¡å—ï¼‰

### 1. åˆ›å»ºå”®åç”³è¯·
**POST** `/api/after-sales`

#### æµç¨‹
```
å®¢æˆ·ç«¯ (HTTPS) â†’ éªŒè¯Tokenå’Œæƒé™ â†’ éªŒè¯è¯·æ±‚æ•°æ® â†’ åˆ›å»ºå”®åè®°å½• â†’ è¿”å›åˆ›å»ºç»“æœ
```

#### æƒé™è¦æ±‚
- ç®¡ç†å‘˜æƒé™ (`Permission.ADMIN`)
- å”®åç®¡ç†æƒé™ (`Permission.AFTER_SALES_MANAGE`)

#### è¯·æ±‚ç¤ºä¾‹
```json
{
  "orderId": "ORDER20231201001",
  "type": 1,
  "reason": "å•†å“è´¨é‡é—®é¢˜",
  "refundAmount": 7999.00
}
```

#### æˆåŠŸå“åº”
```json
{
  "success": true,
  "message": "å”®åç”³è¯·åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 101,
    "orderId": "ORDER20231201001",
    "type": 1,
    "reason": "å•†å“è´¨é‡é—®é¢˜",
    "status": 1,
    "refundAmount": 7999.00,
    "applyTime": "2023-12-01T10:30:00",
    "processTime": null,
    "processRemark": null
  }
}
```

---

### 2. è·å–å”®åè¯¦æƒ…
**GET** `/api/after-sales/{id}`

#### æµç¨‹
```
å®¢æˆ·ç«¯ â†’ éªŒè¯Tokenå’Œæƒé™ â†’ æŸ¥è¯¢æ•°æ®åº“ â†’ è¿”å›å”®åè¯¦æƒ…
```

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "è·å–å”®åè¯¦æƒ…æˆåŠŸ",
  "data": {
    "id": 101,
    "orderId": "ORDER20231201001",
    "type": 1,
    "reason": "å•†å“è´¨é‡é—®é¢˜",
    "status": 1,
    "refundAmount": 7999.00,
    "applyTime": "2023-12-01T10:30:00",
    "processTime": null,
    "processRemark": null
  }
}
```

---

### 3. è·å–å”®ååˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
**GET** `/api/after-sales?page=1&pageSize=20`

#### æŸ¥è¯¢å‚æ•°
- `page` (å¯é€‰, é»˜è®¤1): é¡µç 
- `pageSize` (å¯é€‰, é»˜è®¤20, æœ€å¤§100): æ¯é¡µå¤§å°

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "è·å–å”®ååˆ—è¡¨æˆåŠŸ",
  "data": {
    "data": [
      {
        "id": 101,
        "orderId": "ORDER20231201001",
        "type": 1,
        "reason": "å•†å“è´¨é‡é—®é¢˜",
        "status": 1,
        "refundAmount": 7999.00,
        "applyTime": "2023-12-01T10:30:00"
      }
    ],
    "currentPage": 1,
    "pageSize": 20,
    "totalCount": 50
  }
}
```

---

### 4. è·å–è®¢å•å”®åè®°å½•
**GET** `/api/after-sales/order/{orderId}`

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "è·å–è®¢å•å”®åè®°å½•æˆåŠŸ",
  "data": [
    {
      "id": 101,
      "orderId": "ORDER20231201001",
      "type": 1,
      "reason": "å•†å“è´¨é‡é—®é¢˜",
      "status": 1,
      "refundAmount": 7999.00,
      "applyTime": "2023-12-01T10:30:00"
    }
  ]
}
```

---

### 5. æ ¹æ®çŠ¶æ€è·å–å”®ååˆ—è¡¨
**GET** `/api/after-sales/status/{status}?page=1&pageSize=20`

#### çŠ¶æ€è¯´æ˜
- 1: ç”³è¯·ä¸­
- 2: å®¡æ ¸é€šè¿‡
- 3: å®¡æ ¸æ‹’ç»
- 4: å·²å®Œæˆ

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "è·å–çŠ¶æ€å”®ååˆ—è¡¨æˆåŠŸ",
  "data": {
    "data": [
      {
        "id": 101,
        "orderId": "ORDER20231201001",
        "type": 1,
        "reason": "å•†å“è´¨é‡é—®é¢˜",
        "status": 1,
        "refundAmount": 7999.00,
        "applyTime": "2023-12-01T10:30:00"
      }
    ],
    "currentPage": 1,
    "pageSize": 20,
    "totalCount": 15
  }
}
```

---

### 6. æ›´æ–°å”®åçŠ¶æ€
**PUT** `/api/after-sales/{id}/status`

#### è¯·æ±‚ç¤ºä¾‹
```json
{
  "status": 2,
  "remark": "å®¡æ ¸é€šè¿‡ï¼ŒåŒæ„é€€æ¬¾"
}
```

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "æ›´æ–°å”®åçŠ¶æ€æˆåŠŸ",
  "data": {
    "id": 101,
    "orderId": "ORDER20231201001",
    "type": 1,
    "reason": "å•†å“è´¨é‡é—®é¢˜",
    "status": 2,
    "refundAmount": 7999.00,
    "applyTime": "2023-12-01T10:30:00",
    "processTime": "2023-12-01T14:00:00",
    "processRemark": "å®¡æ ¸é€šè¿‡ï¼ŒåŒæ„é€€æ¬¾"
  }
}
```

---

### 7. åˆ é™¤å”®åè®°å½•
**DELETE** `/api/after-sales/{id}`

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "åˆ é™¤å”®åè®°å½•æˆåŠŸ",
  "data": null
}
```

---

### 8. è·å–å”®åç»Ÿè®¡
**GET** `/api/after-sales/stats`

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "è·å–å”®åç»Ÿè®¡æˆåŠŸ",
  "data": {
    "totalCount": 50
  }
}
```
---

## ğŸ”Œ APIæ¥å£æ–‡æ¡£ï¼ˆç‰©æµç®¡ç†æ¨¡å—ï¼‰

### 1. åˆ›å»ºç‰©æµä¿¡æ¯
**POST** `/api/logistics`

#### æµç¨‹
```
å®¢æˆ·ç«¯ (HTTPS) â†’ éªŒè¯Tokenå’Œæƒé™ â†’ éªŒè¯è¯·æ±‚æ•°æ® â†’ åˆ›å»ºç‰©æµè®°å½• â†’ è¿”å›åˆ›å»ºç»“æœ
```

#### æƒé™è¦æ±‚
- ç®¡ç†å‘˜æƒé™ (`Permission.ADMIN`)
- ç‰©æµç®¡ç†æƒé™ (`Permission.LOGISTICS_MANAGE`)

#### è¯·æ±‚ç¤ºä¾‹
```json
{
  "orderId": "ORDER20231201051",
  "expressCompany": "é¡ºä¸°é€Ÿè¿",
  "trackingNumber": "SF202312015001",
  "senderAddress": "ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒº",
  "receiverAddress": "åŒ—äº¬å¸‚æœé˜³åŒº"
}
```

#### æˆåŠŸå“åº”
```json
{
  "success": true,
  "message": "ç‰©æµä¿¡æ¯åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 51,
    "orderId": "ORDER20231201051",
    "expressCompany": "é¡ºä¸°é€Ÿè¿",
    "trackingNumber": "SF202312015001",
    "status": "pending",
    "senderAddress": "ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒº",
    "receiverAddress": "åŒ—äº¬å¸‚æœé˜³åŒº",
    "shippedAt": null,
    "deliveredAt": null,
    "createdAt": "2023-12-01T10:30:00"
  }
}
```

#### å¤±è´¥å“åº”
```json
{
  "success": false,
  "message": "è¯¥è®¢å•å·²æœ‰ç‰©æµè®°å½•",
  "errorCode": "LOGISTICS_EXISTS"
}
```

---

### 2. æ ¹æ®IDè·å–ç‰©æµè¯¦æƒ…
**GET** `/api/logistics/{id}`

#### æµç¨‹
```
å®¢æˆ·ç«¯ â†’ éªŒè¯Tokenå’Œæƒé™ â†’ æŸ¥è¯¢æ•°æ®åº“ â†’ è¿”å›ç‰©æµè¯¦æƒ…
```

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "è·å–ç‰©æµè¯¦æƒ…æˆåŠŸ",
  "data": {
    "id": 1,
    "orderId": "ORDER20231201001",
    "expressCompany": "é¡ºä¸°é€Ÿè¿",
    "trackingNumber": "SF12345678901",
    "status": "delivered",
    "senderAddress": "ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒº",
    "receiverAddress": "åŒ—äº¬å¸‚æœé˜³åŒº",
    "shippedAt": "2023-12-01T14:00:00",
    "deliveredAt": "2023-12-03T10:00:00",
    "createdAt": "2023-12-01T14:00:00"
  }
}
```

---

### 3. æ ¹æ®è®¢å•å·è·å–ç‰©æµä¿¡æ¯
**GET** `/api/logistics/order/{orderId}`

#### æµç¨‹
```
å®¢æˆ·ç«¯ â†’ éªŒè¯Tokenå’Œæƒé™ â†’ æŸ¥è¯¢æ•°æ®åº“ â†’ è¿”å›ç‰©æµä¿¡æ¯
```

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "è·å–è®¢å•ç‰©æµä¿¡æ¯æˆåŠŸ",
  "data": {
    "id": 1,
    "orderId": "ORDER20231201001",
    "expressCompany": "é¡ºä¸°é€Ÿè¿",
    "trackingNumber": "SF12345678901",
    "status": "delivered",
    "senderAddress": "ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒº",
    "receiverAddress": "åŒ—äº¬å¸‚æœé˜³åŒº",
    "shippedAt": "2023-12-01T14:00:00",
    "deliveredAt": "2023-12-03T10:00:00",
    "createdAt": "2023-12-01T14:00:00"
  }
}
```

---

### 4. è·å–ç‰©æµåˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
**GET** `/api/logistics?page=1&pageSize=20`

#### æŸ¥è¯¢å‚æ•°
- `page` (å¯é€‰, é»˜è®¤1): é¡µç 
- `pageSize` (å¯é€‰, é»˜è®¤20, æœ€å¤§100): æ¯é¡µå¤§å°

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "è·å–ç‰©æµåˆ—è¡¨æˆåŠŸ",
  "data": {
    "data": [
      {
        "id": 1,
        "orderId": "ORDER20231201001",
        "expressCompany": "é¡ºä¸°é€Ÿè¿",
        "trackingNumber": "SF12345678901",
        "status": "delivered",
        "senderAddress": "ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒº",
        "receiverAddress": "åŒ—äº¬å¸‚æœé˜³åŒº",
        "shippedAt": "2023-12-01T14:00:00",
        "deliveredAt": "2023-12-03T10:00:00",
        "createdAt": "2023-12-01T14:00:00"
      }
    ],
    "currentPage": 1,
    "pageSize": 20,
    "totalCount": 50,
    "totalPages": 3
  }
}
```

---

### 5. è·å–å¾…å‘è´§åˆ—è¡¨
**GET** `/api/logistics/pending?page=1&pageSize=20`

#### æŸ¥è¯¢å‚æ•°
- `page` (å¯é€‰, é»˜è®¤1): é¡µç 
- `pageSize` (å¯é€‰, é»˜è®¤20): æ¯é¡µå¤§å°

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "è·å–å¾…å‘è´§åˆ—è¡¨æˆåŠŸ",
  "data": {
    "data": [
      {
        "id": 5,
        "orderId": "ORDER20231201005",
        "expressCompany": null,
        "trackingNumber": null,
        "status": "pending",
        "senderAddress": null,
        "receiverAddress": null,
        "shippedAt": null,
        "deliveredAt": null,
        "createdAt": "2023-12-01T11:00:00"
      }
    ],
    "currentPage": 1,
    "pageSize": 20,
    "totalCount": 10,
    "totalPages": 1
  }
}
```

---

### 6. è·å–è¿è¾“ä¸­åˆ—è¡¨
**GET** `/api/logistics/in-transit?page=1&pageSize=20`

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "è·å–è¿è¾“ä¸­åˆ—è¡¨æˆåŠŸ",
  "data": {
    "data": [
      {
        "id": 3,
        "orderId": "ORDER20231201003",
        "expressCompany": "åœ†é€šé€Ÿé€’",
        "trackingNumber": "YT12345678901",
        "status": "shipped",
        "senderAddress": "å¹¿å·å¸‚å¤©æ²³åŒº",
        "receiverAddress": "æ·±åœ³å¸‚å—å±±åŒº",
        "shippedAt": "2023-12-02T10:00:00",
        "deliveredAt": null,
        "createdAt": "2023-12-02T10:00:00"
      }
    ],
    "currentPage": 1,
    "pageSize": 20,
    "totalCount": 5,
    "totalPages": 1
  }
}
```

---

### 7. æ›´æ–°ç‰©æµä¿¡æ¯
**PUT** `/api/logistics/{id}`

#### è¯·æ±‚ç¤ºä¾‹
```json
{
  "orderId": "ORDER20231201001",
  "expressCompany": "äº¬ä¸œç‰©æµ",
  "trackingNumber": "JD12345678999",
  "senderAddress": "ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºæ–°åœ°å€",
  "receiverAddress": "åŒ—äº¬å¸‚æœé˜³åŒºæ–°åœ°å€"
}
```

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "æ›´æ–°ç‰©æµä¿¡æ¯æˆåŠŸ",
  "data": {
    "id": 1,
    "orderId": "ORDER20231201001",
    "expressCompany": "äº¬ä¸œç‰©æµ",
    "trackingNumber": "JD12345678999",
    "status": "delivered",
    "senderAddress": "ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºæ–°åœ°å€",
    "receiverAddress": "åŒ—äº¬å¸‚æœé˜³åŒºæ–°åœ°å€",
    "shippedAt": "2023-12-01T14:00:00",
    "deliveredAt": "2023-12-03T10:00:00",
    "createdAt": "2023-12-01T14:00:00"
  }
}
```

---

### 8. æ›´æ–°ç‰©æµçŠ¶æ€
**PUT** `/api/logistics/{id}/status`

#### è¯·æ±‚ç¤ºä¾‹
```json
{
  "status": "shipped"
}
```

#### çŠ¶æ€è¯´æ˜
- `pending`: å¾…å‘è´§
- `shipped`: å·²å‘è´§
- `delivered`: å·²é€è¾¾

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "æ›´æ–°ç‰©æµçŠ¶æ€æˆåŠŸ",
  "data": {
    "id": 5,
    "orderId": "ORDER20231201005",
    "expressCompany": null,
    "trackingNumber": null,
    "status": "shipped",
    "senderAddress": null,
    "receiverAddress": null,
    "shippedAt": "2023-12-02T14:00:00",
    "deliveredAt": null,
    "createdAt": "2023-12-01T11:00:00"
  }
}
```

---

### 9. æ›´æ–°å‘è´§ä¿¡æ¯
**PUT** `/api/logistics/{id}/shipping`

#### è¯·æ±‚ç¤ºä¾‹
```json
{
  "expressCompany": "ä¸­é€šå¿«é€’",
  "trackingNumber": "ZT987654321",
  "senderAddress": "ä¸Šæµ·å¸‚å¾æ±‡åŒº"
}
```

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "æ›´æ–°å‘è´§ä¿¡æ¯æˆåŠŸ",
  "data": {
    "id": 5,
    "orderId": "ORDER20231201005",
    "expressCompany": "ä¸­é€šå¿«é€’",
    "trackingNumber": "ZT987654321",
    "status": "shipped",
    "senderAddress": "ä¸Šæµ·å¸‚å¾æ±‡åŒº",
    "receiverAddress": null,
    "shippedAt": "2023-12-02T14:00:00",
    "deliveredAt": null,
    "createdAt": "2023-12-01T11:00:00"
  }
}
```

---

### 10. åˆ é™¤ç‰©æµè®°å½•
**DELETE** `/api/logistics/{id}`

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "åˆ é™¤ç‰©æµè®°å½•æˆåŠŸ",
  "data": null
}
```

---

### 11. è·å–ç‰©æµç»Ÿè®¡
**GET** `/api/logistics/stats`

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "è·å–ç‰©æµç»Ÿè®¡æˆåŠŸ",
  "data": {
    "pendingCount": 10,
    "shippedCount": 5,
    "deliveredCount": 35
  }
}
```

---

### ğŸ” æƒé™æ§åˆ¶

æ‰€æœ‰ç‰©æµç›¸å…³APIå‡ä½¿ç”¨`@RequirePermission`æ³¨è§£è¿›è¡Œæƒé™éªŒè¯ï¼Œéœ€è¦ä»¥ä¸‹ä»»æ„ä¸€ç§æƒé™ï¼š
- ç®¡ç†å‘˜æƒé™ (`Permission.ADMIN`)
- ç‰©æµç®¡ç†æƒé™ (`Permission.LOGISTICS_MANAGE`)

æƒé™éªŒè¯é€»è¾‘ä¸ºORï¼ˆä»»æ„æ»¡è¶³ä¸€ä¸ªå³å¯ï¼‰ï¼Œé€šè¿‡`RequirePermission.LogicType.OR`é…ç½®ã€‚

---

### ğŸ“Š æ•°æ®åº“å­—æ®µè¯´æ˜

ä½¿ç”¨ç°æœ‰è¡¨ `apexflow_logistics`ï¼š
```sql
CREATE TABLE apexflow_logistics (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'ç‰©æµID',
    order_id VARCHAR(50) NOT NULL UNIQUE COMMENT 'å…³è”è®¢å•å·ï¼Œä¸€ä¸ªè®¢å•ä¸€ä¸ªç‰©æµ',
    express_company VARCHAR(50) COMMENT 'å¿«é€’å…¬å¸',
    tracking_number VARCHAR(100) COMMENT 'è¿å•å·',
    status VARCHAR(20) DEFAULT 'pending' COMMENT 'çŠ¶æ€ï¼špending-å¾…å‘è´§ï¼Œshipped-å·²å‘è´§ï¼Œdelivered-å·²é€è¾¾',
    sender_address VARCHAR(200) COMMENT 'å‘è´§åœ°å€',
    receiver_address VARCHAR(200) COMMENT 'æ”¶è´§åœ°å€',
    shipped_at DATETIME COMMENT 'å‘è´§æ—¶é—´',
    delivered_at DATETIME COMMENT 'é€è¾¾æ—¶é—´',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´'
) COMMENT='ç‰©æµä¿¡æ¯è¡¨';
```
---

## ğŸ”Œ APIæ¥å£æ–‡æ¡£ï¼ˆåº“å­˜ç®¡ç†æ¨¡å—ï¼‰

### 1. åˆ›å»ºå•†å“
**POST** `/api/inventory/products`

#### æµç¨‹
```
å®¢æˆ·ç«¯ â†’ éªŒè¯Tokenå’Œæƒé™ â†’ éªŒè¯è¯·æ±‚æ•°æ® â†’ åˆ›å»ºå•†å“è®°å½• â†’ è¿”å›åˆ›å»ºç»“æœ
```

#### æƒé™è¦æ±‚
- ç®¡ç†å‘˜æƒé™ (`Permission.ADMIN`)
- åº“å­˜ç®¡ç†æƒé™ (`Permission.INVENTORY_MANAGE`)

#### è¯·æ±‚ç¤ºä¾‹
```json
{
  "name": "å°ç±³14 Pro",
  "category": "æ‰‹æœº",
  "price": 4999.00,
  "stock": 100,
  "status": 1,
  "image": "xiaomi14.jpg"
}
```

#### æˆåŠŸå“åº”
```json
{
  "success": true,
  "message": "å•†å“åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 51,
    "name": "å°ç±³14 Pro",
    "category": "æ‰‹æœº",
    "price": 4999.00,
    "stock": 100,
    "status": 1,
    "image": "xiaomi14.jpg",
    "createdAt": "2023-12-01T10:30:00"
  }
}
```

#### å¤±è´¥å“åº”
```json
{
  "success": false,
  "message": "å•†å“åç§°å’Œä»·æ ¼ä¸èƒ½ä¸ºç©º",
  "errorCode": "INVALID_REQUEST"
}
```

---

### 2. è·å–å•†å“è¯¦æƒ…
**GET** `/api/inventory/products/{id}`

#### æµç¨‹
```
å®¢æˆ·ç«¯ â†’ éªŒè¯Tokenå’Œæƒé™ â†’ æŸ¥è¯¢æ•°æ®åº“ â†’ è¿”å›å•†å“è¯¦æƒ…
```

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "å•†å“è¯¦æƒ…è·å–æˆåŠŸ",
  "data": {
    "id": 1,
    "name": "iPhone 14 Pro",
    "category": "æ‰‹æœº",
    "price": 7999.00,
    "stock": 95,
    "status": 1,
    "image": "iphone14.jpg",
    "createdAt": "2023-12-01T10:00:00"
  }
}
```

---

### 3. è·å–å•†å“åˆ—è¡¨
**GET** `/api/inventory/products/list`

#### æŸ¥è¯¢å‚æ•°
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| category | string | å¦ | å•†å“åˆ†ç±»ç­›é€‰ |
| keyword | string | å¦ | å•†å“åç§°æœç´¢ |
| status | integer | å¦ | å•†å“çŠ¶æ€ (1-ä¸Šæ¶, 0-ä¸‹æ¶) |
| page | integer | å¦ | é¡µç ï¼Œé»˜è®¤1 |
| pageSize | integer | å¦ | æ¯é¡µå¤§å°ï¼Œé»˜è®¤20ï¼Œæœ€å¤§100 |

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "å•†å“åˆ—è¡¨è·å–æˆåŠŸ",
  "data": {
    "products": [
      {
        "id": 1,
        "name": "iPhone 14 Pro",
        "category": "æ‰‹æœº",
        "price": 7999.00,
        "stock": 95,
        "status": 1,
        "image": "iphone14.jpg",
        "createdAt": "2023-12-01T10:00:00"
      }
    ],
    "currentPage": 1,
    "pageSize": 20,
    "totalCount": 50,
    "totalPages": 3
  }
}
```

---

### 4. æ›´æ–°å•†å“ä¿¡æ¯
**PUT** `/api/inventory/products/{id}`

#### è¯·æ±‚ç¤ºä¾‹
```json
{
  "name": "iPhone 14 Pro Max",
  "price": 8999.00,
  "stock": 120
}
```

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "å•†å“ä¿¡æ¯æ›´æ–°æˆåŠŸ",
  "data": null
}
```

---

### 5. åˆ é™¤å•†å“ï¼ˆä¸‹æ¶ï¼‰
**DELETE** `/api/inventory/products/{id}`

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "å•†å“å·²ä¸‹æ¶",
  "data": null
}
```

---

### 6. è°ƒæ•´åº“å­˜
**PUT** `/api/inventory/products/{id}/stock`

#### è¯·æ±‚ç¤ºä¾‹
```json
{
  "newStock": 150,
  "reason": "ç›˜ç‚¹è°ƒæ•´"
}
```

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "åº“å­˜è°ƒæ•´æˆåŠŸ",
  "data": null
}
```

---

### 7. å¢åŠ åº“å­˜ï¼ˆé‡‡è´­å…¥åº“ï¼‰
**POST** `/api/inventory/stock/increase`

#### è¯·æ±‚ç¤ºä¾‹
```json
{
  "productId": 1,
  "quantity": 50,
  "orderId": "PUR20231201001"
}
```

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "åº“å­˜å¢åŠ æˆåŠŸ",
  "data": null
}
```

---

### 8. å‡å°‘åº“å­˜ï¼ˆé”€å”®å‡ºåº“ï¼‰
**POST** `/api/inventory/stock/decrease`

#### è¯·æ±‚ç¤ºä¾‹
```json
{
  "productId": 1,
  "quantity": 2,
  "orderId": "ORDER20231201051"
}
```

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "åº“å­˜å‡å°‘æˆåŠŸ",
  "data": null
}
```

---

### 9. è·å–åº“å­˜å˜æ›´æ—¥å¿—
**GET** `/api/inventory/logs`

#### æŸ¥è¯¢å‚æ•°
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| productId | integer | å¦ | å•†å“IDç­›é€‰ |
| changeType | string | å¦ | å˜æ›´ç±»å‹ (purchase/sale/adjust) |
| page | integer | å¦ | é¡µç ï¼Œé»˜è®¤1 |
| pageSize | integer | å¦ | æ¯é¡µå¤§å°ï¼Œé»˜è®¤20 |

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "åº“å­˜å˜æ›´æ—¥å¿—è·å–æˆåŠŸ",
  "data": {
    "logs": [
      {
        "id": 1,
        "productId": 1,
        "changeType": "sale",
        "quantity": -1,
        "beforeStock": 100,
        "afterStock": 99,
        "orderId": "ORDER20231201001",
        "createdAt": "2023-12-01T14:00:00"
      }
    ],
    "currentPage": 1,
    "pageSize": 20,
    "totalCount": 50
  }
}
```

---

### 10. è·å–ä½åº“å­˜é¢„è­¦
**GET** `/api/inventory/low-stock`

#### æŸ¥è¯¢å‚æ•°
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| threshold | integer | å¦ | é¢„è­¦é˜ˆå€¼ï¼Œé»˜è®¤10 |

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "ä½åº“å­˜é¢„è­¦è·å–æˆåŠŸ",
  "data": {
    "threshold": 10,
    "lowStockProducts": [
      {
        "id": 24,
        "name": "æµ·è“ä¹‹è°œç²¾å",
        "category": "ç¾å¦†",
        "price": 2999.00,
        "stock": 5,
        "status": 1,
        "image": "lamer.jpg",
        "createdAt": "2023-12-01T10:00:00"
      }
    ],
    "count": 3
  }
}
```
---

## ğŸ”§ æŠ€æœ¯å®ç°è¦ç‚¹

### 1. å¯†ç éªŒè¯ï¼ˆä½¿ç”¨ç°æœ‰æ•°æ®åº“ç»“æ„ï¼‰
```java
public class SecurityUtil {
    
    /**
     * éªŒè¯å¯†ç ï¼ˆä¸æ•°æ®åº“å­˜å‚¨æ–¹å¼ä¸€è‡´ï¼‰
     * æ•°æ®åº“ï¼špassword_hash = hash(password + salt)
     */
    public static boolean verifyPassword(String inputPassword, String storedHash, String salt) {
        String inputHash = hashPassword(inputPassword, salt);
        return inputHash.equals(storedHash);
    }
    
    private static String hashPassword(String password, String salt) {
        // ä¸åˆ›å»ºç”¨æˆ·æ—¶çš„å“ˆå¸Œç®—æ³•ä¿æŒä¸€è‡´
        // ç°æœ‰æ•°æ®åº“ç¤ºä¾‹ï¼šsaltæ˜¯32ä½å­—ç¬¦ä¸²ï¼Œå“ˆå¸Œç®—æ³•å¯èƒ½æ˜¯SHA-256
        try {
            MessageDigest md = MessageDigest.getInstance("SHA-256");
            String saltedPassword = password + salt;
            byte[] hash = md.digest(saltedPassword.getBytes());
            return Base64.getEncoder().encodeToString(hash);
        } catch (Exception e) {
            throw new RuntimeException("å¯†ç éªŒè¯å¤±è´¥", e);
        }
    }
}
```

### 2. JWT Tokenç”Ÿæˆ
```java
public class JwtUtil {
    private static final String SECRET = "your_jwt_secret_key";
    private static final long EXPIRATION = 3600000; // 1å°æ—¶
    
    public static String generateToken(Integer userId, String username, Boolean isAdmin) {
        return Jwts.builder()
                .setSubject(userId.toString())
                .claim("username", username)
                .claim("isAdmin", isAdmin)
                .setIssuedAt(new Date())
                .setExpiration(new Date(System.currentTimeMillis() + EXPIRATION))
                .signWith(SignatureAlgorithm.HS512, SECRET)
                .compact();
    }
    
    public static Claims validateToken(String token) {
        try {
            return Jwts.parser()
                    .setSigningKey(SECRET)
                    .parseClaimsJws(token)
                    .getBody();
        } catch (Exception e) {
            return null;
        }
    }
}
```

### 3. ç»Ÿä¸€å“åº”æ ¼å¼
```java
public class ApiResponse<T> {
    private boolean success;
    private String message;    // ä»…å¤±è´¥æ—¶æœ‰
    private T data;            // ä»…æˆåŠŸæ—¶æœ‰
    
    // é™æ€å·¥å‚æ–¹æ³•
    public static <T> ApiResponse<T> success(T data) {
        ApiResponse<T> response = new ApiResponse<>();
        response.setSuccess(true);
        response.setData(data);
        return response;
    }
    
    public static ApiResponse<Void> error(String message) {
        ApiResponse<Void> response = new ApiResponse<>();
        response.setSuccess(false);
        response.setMessage(message);
        return response;
    }
    
    // getters and setters
}
```

### 4. TokenéªŒè¯è¿‡æ»¤å™¨
```java
@WebFilter("/api/*")
public class TokenFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain) 
            throws IOException, ServletException {
        
        HttpServletRequest request = (HttpServletRequest) req;
        HttpServletResponse response = (HttpServletResponse) res;
        
        // ç™½åå•ï¼šç™»å½•å’Œå…¬å¼€API
        String path = request.getRequestURI();
        if (path.endsWith("/api/auth/login")) {
            chain.doFilter(request, response);
            return;
        }
        
        // éªŒè¯Token
        String token = extractToken(request);
        if (token == null) {
            sendError(response, 401, "éœ€è¦èº«ä»½éªŒè¯");
            return;
        }
        
        Claims claims = JwtUtil.validateToken(token);
        if (claims == null) {
            sendError(response, 401, "Tokenæ— æ•ˆæˆ–å·²è¿‡æœŸ");
            return;
        }
        
        // è®¾ç½®ç”¨æˆ·ä¸Šä¸‹æ–‡
        Integer userId = Integer.parseInt(claims.getSubject());
        request.setAttribute("userId", userId);
        
        chain.doFilter(request, response);
    }
    
    private String extractToken(HttpServletRequest request) {
        String header = request.getHeader("Authorization");
        if (header != null && header.startsWith("Bearer ")) {
            return header.substring(7);
        }
        return null;
    }
}
```

### 5. UserServletæ ¸å¿ƒé€»è¾‘
```java
@WebServlet("/api/*")
public class UserServlet extends BaseServlet {
    private final UserDAO userDAO = new UserDAO();
    
    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) 
            throws ServletException, IOException {
        
        String path = req.getPathInfo();
        
        if ("/auth/login".equals(path)) {
            handleLogin(req, resp);
        } else if ("/auth/logout".equals(path)) {
            handleLogout(req, resp);
        } else {
            sendError(resp, 404, "APIä¸å­˜åœ¨");
        }
    }
    
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) 
            throws ServletException, IOException {
        
        String path = req.getPathInfo();
        
        if ("/user/permissions".equals(path)) {
            handleGetPermissions(req, resp);
        } else {
            sendError(resp, 404, "APIä¸å­˜åœ¨");
        }
    }
    
    @Override
    protected void doPut(HttpServletRequest req, HttpServletResponse resp) 
            throws ServletException, IOException {
        
        String path = req.getPathInfo();
        
        if ("/user/profile".equals(path)) {
            handleUpdateProfile(req, resp);
        } else {
            sendError(resp, 404, "APIä¸å­˜åœ¨");
        }
    }
    
    private void handleLogin(HttpServletRequest req, HttpServletResponse resp) 
            throws IOException {
        
        // è§£æè¯·æ±‚
        LoginRequest loginReq = parseJsonBody(req, LoginRequest.class);
        
        // æŸ¥è¯¢ç”¨æˆ·
        SystemUser user = userDAO.findByUsername(loginReq.getUsername());
        if (user == null) {
            sendJsonResponse(resp, 401, ApiResponse.error("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"));
            return;
        }
        
        // éªŒè¯å¯†ç 
        boolean valid = SecurityUtil.verifyPassword(
            loginReq.getPassword(),
            user.getPasswordHash(),
            user.getSalt()
        );
        
        if (!valid) {
            sendJsonResponse(resp, 401, ApiResponse.error("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"));
            return;
        }
        
        // æ£€æŸ¥çŠ¶æ€
        if (user.getStatus() != 1) {
            sendJsonResponse(resp, 403, ApiResponse.error("ç”¨æˆ·å·²è¢«ç¦ç”¨"));
            return;
        }
        
        // ç”ŸæˆToken
        String token = JwtUtil.generateToken(
            user.getId(),
            user.getUsername(),
            user.getAdmin()
        );
        
        // æ›´æ–°ç™»å½•æ—¶é—´
        userDAO.updateLastLoginTime(user.getId());
        
        // è¿”å›å“åº”
        LoginResponse loginResp = new LoginResponse();
        loginResp.setToken(token);
        
        UserInfo userInfo = new UserInfo();
        userInfo.setId(user.getId());
        userInfo.setUsername(user.getUsername());
        userInfo.setRealName(user.getRealName());
        userInfo.setAdmin(user.getAdmin());
        loginResp.setUser(userInfo);
        
        sendJsonResponse(resp, 200, ApiResponse.success(loginResp));
    }
    
    private void handleGetPermissions(HttpServletRequest req, HttpServletResponse resp) 
            throws IOException {
        
        Integer userId = (Integer) req.getAttribute("userId");
        SystemUser user = userDAO.findById(userId);
        
        PermissionResponse permissions = new PermissionResponse();
        permissions.setAdmin(user.getAdmin());
        permissions.setCanManageOrder(user.getCanManageOrder());
        permissions.setCanManageLogistics(user.getCanManageLogistics());
        permissions.setCanManageAfterSales(user.getCanManageAfterSales());
        permissions.setCanManageReview(user.getCanManageReview());
        permissions.setCanManageInventory(user.getCanManageInventory());
        permissions.setCanManageIncome(user.getCanManageIncome());
        
        sendJsonResponse(resp, 200, ApiResponse.success(permissions));
    }
    
    private void handleUpdateProfile(HttpServletRequest req, HttpServletResponse resp) 
            throws IOException {
        
        Integer userId = (Integer) req.getAttribute("userId");
        UpdateProfileRequest updateReq = parseJsonBody(req, UpdateProfileRequest.class);
        
        // æ•°æ®éªŒè¯
        if (!updateReq.hasUpdateFields()) {
            sendJsonResponse(resp, 400, ApiResponse.error("è‡³å°‘éœ€è¦ä¸€ä¸ªæ›´æ–°å­—æ®µ"));
            return;
        }
        
        // é‚®ç®±å”¯ä¸€æ€§æ£€æŸ¥
        if (updateReq.getEmail() != null) {
            SystemUser existing = userDAO.findByEmail(updateReq.getEmail());
            if (existing != null && !existing.getId().equals(userId)) {
                sendJsonResponse(resp, 409, ApiResponse.error("é‚®ç®±å·²è¢«ä½¿ç”¨"));
                return;
            }
        }
        
        // æ›´æ–°ç”¨æˆ·
        SystemUser user = userDAO.findById(userId);
        if (updateReq.getRealName() != null) {
            user.setRealName(updateReq.getRealName());
        }
        if (updateReq.getEmail() != null) {
            user.setEmail(updateReq.getEmail());
        }
        if (updateReq.getPhone() != null) {
            user.setPhone(updateReq.getPhone());
        }
        
        boolean success = userDAO.update(user);
        if (!success) {
            sendJsonResponse(resp, 500, ApiResponse.error("æ›´æ–°å¤±è´¥"));
            return;
        }
        
        // è¿”å›æ›´æ–°åçš„ä¿¡æ¯
        ProfileResponse profileResp = new ProfileResponse();
        profileResp.setId(user.getId());
        profileResp.setRealName(user.getRealName());
        profileResp.setEmail(user.getEmail());
        profileResp.setPhone(user.getPhone());
        
        sendJsonResponse(resp, 200, ApiResponse.success(profileResp));
    }
    
    private void handleLogout(HttpServletRequest req, HttpServletResponse resp) 
            throws IOException {
        // æ— çŠ¶æ€å®ç°ï¼šå®¢æˆ·ç«¯ä¸¢å¼ƒTokenå³å¯
        sendJsonResponse(resp, 200, ApiResponse.success(null));
    }
}
```

### 6. DTOç±»ï¼ˆç®€æ´ç‰ˆï¼‰

```java
// ç™»å½•è¯·æ±‚
public class LoginRequest {
    private String username;
    private String password;
    // getters and setters
}

// ç™»å½•å“åº”
public class LoginResponse {
    private String token;
    private UserInfo user;
    // getters and setters
}

// ç”¨æˆ·ä¿¡æ¯
public class UserInfo {
    private Integer id;
    private String username;
    private String realName;
    private Boolean admin;
    // getters and setters
}

// æƒé™å“åº”
public class PermissionResponse {
    private Boolean admin;
    private Boolean canManageOrder;
    private Boolean canManageLogistics;
    private Boolean canManageAfterSales;
    private Boolean canManageReview;
    private Boolean canManageInventory;
    private Boolean canManageIncome;
    // getters and setters
}

// æ›´æ–°ä¸ªäººä¿¡æ¯è¯·æ±‚
public class UpdateProfileRequest {
    private String realName;
    private String email;
    private String phone;
    
    public boolean hasUpdateFields() {
        return realName != null || email != null || phone != null;
    }
    // getters and setters
}

// ä¸ªäººä¿¡æ¯å“åº”
public class ProfileResponse {
    private Integer id;
    private String realName;
    private String email;
    private String phone;
    // getters and setters
}
```

## ğŸ“¦ ä¾èµ–éœ€æ±‚

### Mavenä¾èµ–
```xml
<dependencies>
    <!-- JWT -->
    <dependency>
        <groupId>io.jsonwebtoken</groupId>
        <artifactId>jjwt-api</artifactId>
        <version>0.11.5</version>
    </dependency>
    <dependency>
        <groupId>io.jsonwebtoken</groupId>
        <artifactId>jjwt-impl</artifactId>
        <version>0.11.5</version>
        <scope>runtime</scope>
    </dependency>
    <dependency>
        <groupId>io.jsonwebtoken</groupId>
        <artifactId>jjwt-jackson</artifactId>
        <version>0.11.5</version>
        <scope>runtime</scope>
    </dependency>
    
    <!-- å…¶ä»–ç°æœ‰ä¾èµ– -->
    <dependency>
        <groupId>javax.servlet</groupId>
        <artifactId>javax.servlet-api</artifactId>
        <version>4.0.1</version>
        <scope>provided</scope>
    </dependency>
    <dependency>
        <groupId>com.fasterxml.jackson.core</groupId>
        <artifactId>jackson-databind</artifactId>
        <version>2.13.3</version>
    </dependency>
</dependencies>
```

## ğŸ”’ å®‰å…¨é…ç½®

### 1. å¯†ç ç­–ç•¥
- ç°æœ‰æ•°æ®åº“ï¼š`password_hash = hash(password + salt)`
- ç›å€¼ï¼š32ä½éšæœºå­—ç¬¦ä¸²ï¼ˆå·²å­˜åœ¨ï¼‰
- å“ˆå¸Œç®—æ³•ï¼šSHA-256

### 2. Tokené…ç½®
```properties
# application.properties
jwt.secret=your-strong-secret-key-change-in-production
jwt.expiration=3600 # 1å°æ—¶
```

### 3. HTTPSå¼ºåˆ¶
```nginx
# Nginxé…ç½®
server {
    listen 80;
    server_name api.example.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl;
    server_name api.example.com;
    
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    
    location /api/ {
        proxy_pass http://localhost:8080;
    }
}
```

## ğŸ“ æ•°æ®åº“éªŒè¯
ç¡®ä¿ç°æœ‰è¡¨ç»“æ„ï¼š
```sql
CREATE TABLE apexflow_system_user (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    salt VARCHAR(32) NOT NULL,
    real_name VARCHAR(50),
    email VARCHAR(100),
    phone VARCHAR(20),
    is_admin BOOLEAN DEFAULT FALSE,
    can_manage_order BOOLEAN DEFAULT FALSE,
    can_manage_logistics BOOLEAN DEFAULT FALSE,
    can_manage_after_sales BOOLEAN DEFAULT FALSE,
    can_manage_review BOOLEAN DEFAULT FALSE,
    can_manage_inventory BOOLEAN DEFAULT FALSE,
    can_manage_income BOOLEAN DEFAULT FALSE,
    status TINYINT DEFAULT 1,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    last_login_at DATETIME
);
```

## ğŸš€ å¿«é€Ÿæµ‹è¯•

### æµ‹è¯•ç™»å½•
```bash
curl -X POST https://api.example.com/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"your_password"}'
```

### æµ‹è¯•æƒé™è·å–
```bash
curl -X GET https://api.example.com/api/user/permissions \
  -H "Authorization: Bearer your_jwt_token"
```

### æµ‹è¯•æ›´æ–°ä¿¡æ¯
```bash
curl -X PUT https://api.example.com/api/user/profile \
  -H "Authorization: Bearer your_jwt_token" \
  -H "Content-Type: application/json" \
  -d '{"realName":"å¼ ä¸‰","email":"zhangsan@example.com"}'
```

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿
1. **ç®€æ´**ï¼šä»…4ä¸ªAPIï¼Œå“åº”æ•°æ®æœ€å°åŒ–
2. **å…¼å®¹**ï¼šå®Œå…¨åŸºäºç°æœ‰æ•°æ®åº“è¡¨
3. **å®‰å…¨**ï¼šHTTPSä¼ è¾“ + åç«¯å“ˆå¸ŒéªŒè¯
4. **æ— çŠ¶æ€**ï¼šJWT Tokenï¼Œæ— éœ€é¢å¤–å­˜å‚¨
5. **å¯æ‰©å±•**ï¼šåŸºç¡€æ¡†æ¶æ˜“äºæ·»åŠ æ–°åŠŸèƒ½

è¿™ä¸ªå®ç°åˆ é™¤äº†æ‰€æœ‰éå¿…è¦åŠŸèƒ½ï¼Œä¸“æ³¨äºå››ä¸ªæ ¸å¿ƒAPIçš„å®ç°ï¼Œä»£ç é‡å‡å°‘60%ä»¥ä¸Šï¼ŒåŒæ—¶ä¿æŒç”Ÿäº§çº§å®‰å…¨æ€§ã€‚

## ğŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•
```bash
# è¿è¡Œåç«¯å•å…ƒæµ‹è¯•
cd apexflow-server
mvn test

# è¿è¡Œå‰ç«¯å•å…ƒæµ‹è¯•
cd ../apexflow-web
npm run test:unit
```

### é›†æˆæµ‹è¯•
```bash
# è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•
cd apexflow-web
npm run test:e2e
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼å‚ä¸é¡¹ç›®æ­¥éª¤å¦‚ä¸‹ï¼š

1. **Fork é¡¹ç›®**ï¼šç‚¹å‡»å³ä¸Šè§’çš„ForkæŒ‰é’®
2. **å…‹éš†ä»“åº“**ï¼š`git clone https://github.com/yourusername/apexflow.git`
3. **åˆ›å»ºåˆ†æ”¯**ï¼š`git checkout -b feature/your-feature-name`
4. **æäº¤æ›´æ”¹**ï¼š`git commit -m 'Add some feature'`
5. **æ¨é€åˆ°åˆ†æ”¯**ï¼š`git push origin feature/your-feature-name`
6. **æäº¤Pull Request**

### å¼€å‘è§„èŒƒ
- Javaä»£ç éµå¾ªé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œ
- Vueç»„ä»¶ä½¿ç”¨ç»„åˆå¼APIç¼–å†™
- æäº¤ä¿¡æ¯ä½¿ç”¨è‹±æ–‡æè¿°ï¼Œæ ¼å¼ä¸ºï¼š`type(scope): message`
- æ–°å¢åŠŸèƒ½éœ€åŒ…å«ç›¸åº”çš„å•å…ƒæµ‹è¯•

### ä»£ç æäº¤ç±»å‹
- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼è°ƒæ•´
- `refactor`: ä»£ç é‡æ„
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·å˜åŠ¨

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº **GNU General Public License v3.0** å¼€æºåè®®å‘å¸ƒã€‚

```
ApexFlow - ç”µå•†ä¿¡æ¯ç®¡ç†ç³»ç»Ÿ
Copyright (C) 2023 ApexFlow Contributors

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/>.
```

## ğŸ“ æ”¯æŒä¸è”ç³»

- **é¡¹ç›®ä¸»é¡µ**: [https://github.com/yourusername/apexflow](https://github.com/yourusername/apexflow)
- **é—®é¢˜åé¦ˆ**: [GitHub Issues](https://github.com/yourusername/apexflow/issues)
- **è®¨è®ºåŒº**: [GitHub Discussions](https://github.com/yourusername/apexflow/discussions)
- **é‚®ç®±**: apexflow@example.com

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ä¸ºApexFlowæä¾›æ”¯æŒï¼š
- [Vue.js](https://vuejs.org/)
- [Element Plus](https://element-plus.org/)
- [Apache Tomcat](https://tomcat.apache.org/)
- [MySQL](https://www.mysql.com/)

---

**ApexFlow** - ç®€åŒ–ç”µå•†ç®¡ç†ï¼Œæå‡è¿è¥æ•ˆç‡ï¼