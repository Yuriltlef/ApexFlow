import{_ as j,r as g,a as W,o as P,b as Y,c as E,d as $,e as s,f as a,w as o,E as q,g as U,h as H,i as J,n as K,u as Q,j as X,k as w,l as b,m as Z,p as _,q as tt,s as et,t as f,v as at,x as st,y as ot,z as lt,A as nt,B as rt,C as dt,D as it,F as ct,G as ut}from"./index-C-PAn4RE.js";/* empty css                *//* empty css                        *//* empty css               */import{i as z}from"./index-CiU0J0Xr.js";const ft={class:"dashboard-page"},_t={key:0,class:"guest-overlay"},pt={class:"guest-alert"},mt={class:"stat-content"},vt={class:"stat-icon",style:{background:"#e8f4ff",color:"#0366d6"}},yt={class:"stat-info"},ht={class:"stat-value"},gt={class:"stat-trend"},bt={class:"stat-content"},wt={class:"stat-icon",style:{background:"#f6ffed",color:"#52c41a"}},St={class:"stat-info"},Ct={class:"stat-value"},At={class:"stat-content"},Dt={class:"stat-icon",style:{background:"#fff7e6",color:"#fa8c16"}},Et={class:"stat-info"},Tt={class:"stat-value"},kt={class:"stat-content"},xt={class:"stat-icon",style:{background:"#fff1f0",color:"#f5222d"}},$t={class:"stat-info"},zt={class:"stat-value"},Mt={key:0,class:"stat-trend"},Ot={__name:"Dashboard",setup(Ft){const S=g(!1),C=g(!1),T=g([]),u=W({todayCount:0,totalSales:0,totalOrders:0,pendingCount:0}),A=g(null),D=g(null);let m=null,v=null;const M=()=>{C.value=Q.isGuest()},O=()=>{ut.info("请联系管理员 admin@apexflow.com")},F=async()=>{S.value=!0;try{const e=await X();let t=[];if(e&&e.data&&Array.isArray(e.data.orders)?t=e.data.orders:e&&e.data&&Array.isArray(e.data)?t=e.data:e&&Array.isArray(e)&&(t=e),console.log("获取仪表盘订单数据",t),t.length>0){I(t),R(t);const n=[...t].sort((r,l)=>{const i=Array.isArray(r.createTime)?h(r.createTime):r.createTime,d=Array.isArray(l.createTime)?h(l.createTime):l.createTime;return new Date(d)-new Date(i)});T.value=n.slice(0,5)}}catch(e){console.error("仪表盘数据获取失败",e)}finally{S.value=!1}},I=e=>{const t=new Date,n=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`;let r=0,l=0,i=0;e.forEach(d=>{l+=Number(d.totalAmount||0),d.status===1&&i++,h(d.createTime).startsWith(n)&&r++}),u.totalOrders=e.length,u.totalSales=l,u.pendingCount=i,u.todayCount=r},R=e=>{if(!A.value||!D.value)return;const t={};for(let r=6;r>=0;r--){const l=new Date;l.setDate(l.getDate()-r);const i=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`;t[i]=0}e.forEach(r=>{const l=h(r.createTime).substring(0,10);t.hasOwnProperty(l)&&t[l]++});const n={1:0,2:0,3:0,4:0,5:0};e.forEach(r=>{n[r.status]!==void 0&&n[r.status]++}),m=z(A.value),m.setOption({tooltip:{trigger:"axis"},grid:{top:"10%",left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:Object.keys(t)},yAxis:{type:"value"},series:[{data:Object.values(t),type:"line",smooth:!0,areaStyle:{opacity:.2},itemStyle:{color:"#409EFF"},lineStyle:{color:"#409EFF"}}]}),v=z(D.value),v.setOption({tooltip:{trigger:"item"},legend:{bottom:"0%"},series:[{type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"16",fontWeight:"bold"}},data:[{value:n[1],name:"待付款",itemStyle:{color:"#e6a23c"}},{value:n[2],name:"已支付",itemStyle:{color:"#409eff"}},{value:n[3],name:"已发货",itemStyle:{color:"#67c23a"}},{value:n[4],name:"已完成",itemStyle:{color:"#67c23a"}},{value:n[5],name:"已取消",itemStyle:{color:"#909399"}}]}]})},k=e=>Number(e||0).toFixed(2),h=e=>{if(!e)return"-";if(!Array.isArray(e))return String(e);const[t,n,r,l,i]=e,d=p=>p<10?"0"+p:p;return`${t}-${d(n)}-${d(r)} ${d(l)}:${d(i)}`},B=e=>({1:"待付款",2:"已支付",3:"已发货",4:"已完成",5:"已取消"})[e]||`状态${e}`,N=e=>e===4?"success":e===2||e===3?"primary":e===1?"warning":e===5?"info":"",L=e=>({wxpay:"微信支付",alipay:"支付宝",credit_card:"信用卡"})[e]||e||"-",x=()=>{m&&m.resize(),v&&v.resize()};return P(()=>{M(),F(),window.addEventListener("resize",x)}),Y(()=>{window.removeEventListener("resize",x),m&&m.dispose(),v&&v.dispose()}),(e,t)=>{const n=q,r=U,l=at,i=J,d=tt,p=H,y=it,G=dt,V=ct;return w(),E("div",ft,[C.value?(w(),E("div",_t,[s("div",pt,[a(n,{class:"guest-icon"},{default:o(()=>[a(b(Z))]),_:1}),t[1]||(t[1]=s("h3",null,"访客模式限制",-1)),t[2]||(t[2]=s("p",null,"当前用户为游客模式，数据仅供演示预览。",-1)),t[3]||(t[3]=s("p",null,"若要正常使用所有功能，请联系管理员获取账户。",-1)),a(r,{type:"primary",onClick:O},{default:o(()=>[...t[0]||(t[0]=[_("联系管理员",-1)])]),_:1})])])):$("",!0),s("div",{class:K(["dashboard-content",{"content-blur":C.value}])},[a(p,{gutter:16,class:"stats-row"},{default:o(()=>[a(d,{span:6},{default:o(()=>[a(i,{class:"stat-card",shadow:"never"},{default:o(()=>[s("div",mt,[s("div",vt,[a(n,null,{default:o(()=>[a(b(et))]),_:1})]),s("div",yt,[s("div",ht,f(u.todayCount),1),t[4]||(t[4]=s("div",{class:"stat-label"},"今日订单",-1))]),s("div",gt,[a(l,{size:"small",type:"primary"},{default:o(()=>[...t[5]||(t[5]=[_("实时",-1)])]),_:1})])])]),_:1})]),_:1}),a(d,{span:6},{default:o(()=>[a(i,{class:"stat-card",shadow:"never"},{default:o(()=>[s("div",bt,[s("div",wt,[a(n,null,{default:o(()=>[a(b(st))]),_:1})]),s("div",St,[s("div",Ct,"¥"+f(k(u.totalSales)),1),t[6]||(t[6]=s("div",{class:"stat-label"},"总销售额",-1))])])]),_:1})]),_:1}),a(d,{span:6},{default:o(()=>[a(i,{class:"stat-card",shadow:"never"},{default:o(()=>[s("div",At,[s("div",Dt,[a(n,null,{default:o(()=>[a(b(ot))]),_:1})]),s("div",Et,[s("div",Tt,f(u.totalOrders),1),t[7]||(t[7]=s("div",{class:"stat-label"},"总订单数",-1))])])]),_:1})]),_:1}),a(d,{span:6},{default:o(()=>[a(i,{class:"stat-card",shadow:"never"},{default:o(()=>[s("div",kt,[s("div",xt,[a(n,null,{default:o(()=>[a(b(lt))]),_:1})]),s("div",$t,[s("div",zt,f(u.pendingCount),1),t[8]||(t[8]=s("div",{class:"stat-label"},"待处理订单",-1))]),u.pendingCount>0?(w(),E("div",Mt,[a(l,{size:"small",type:"danger"},{default:o(()=>[...t[9]||(t[9]=[_("急",-1)])]),_:1})])):$("",!0)])]),_:1})]),_:1})]),_:1}),a(p,{gutter:16,class:"charts-row"},{default:o(()=>[a(d,{span:16},{default:o(()=>[a(i,{class:"chart-card",shadow:"never"},{default:o(()=>[t[10]||(t[10]=s("div",{class:"card-header"},[s("span",null,"近7天订单趋势")],-1)),s("div",{ref_key:"trendChartRef",ref:A,class:"chart-container"},null,512)]),_:1})]),_:1}),a(d,{span:8},{default:o(()=>[a(i,{class:"chart-card",shadow:"never"},{default:o(()=>[t[11]||(t[11]=s("div",{class:"card-header"},[s("span",null,"订单状态分布")],-1)),s("div",{ref_key:"pieChartRef",ref:D,class:"chart-container"},null,512)]),_:1})]),_:1})]),_:1}),a(i,{class:"table-card",shadow:"never"},{default:o(()=>[t[12]||(t[12]=s("div",{class:"card-header"},[s("span",null,"最新订单")],-1)),nt((w(),rt(G,{data:T.value,stripe:"",style:{width:"100%"}},{default:o(()=>[a(y,{label:"订单号","min-width":"180"},{default:o(({row:c})=>[_(f(c.orderId),1)]),_:1}),a(y,{label:"客户ID",width:"100",prop:"userId"}),a(y,{label:"金额",width:"120"},{default:o(({row:c})=>[_(" ¥"+f(k(c.totalAmount)),1)]),_:1}),a(y,{label:"状态",width:"100"},{default:o(({row:c})=>[a(l,{type:N(c.status),size:"small",effect:"plain"},{default:o(()=>[_(f(B(c.status)),1)]),_:2},1032,["type"])]),_:1}),a(y,{label:"支付方式",width:"100"},{default:o(({row:c})=>[_(f(L(c.paymentMethod)),1)]),_:1}),a(y,{label:"创建时间",width:"160"},{default:o(({row:c})=>[_(f(h(c.createTime)),1)]),_:1})]),_:1},8,["data"])),[[V,S.value]])]),_:1})],2)])}}},Gt=j(Ot,[["__scopeId","data-v-44340b83"]]);export{Gt as default};
