import{_ as ne,r as _,a as se,H as P,o as de,c as M,e as i,f as l,w as o,i as ue,I as ie,J as R,G as m,k as b,A as pe,B as K,C as ce,D as me,t as p,p as u,v as fe,g as _e,F as ye,K as ge,L as ve,l as E,M as be,N as Ie,O as he,P as we,Q as Ve,R as xe,S as ke,T as Ce,U as De,d as j,V as Me,W as Ee,X as Te,Y as ze,Z as Ne,$ as Oe,a0 as Ue,a1 as $e}from"./index-DD_-ku_t.js";/* empty css                *//* empty css                             *//* empty css                      *//* empty css                        */const Se={class:"order-page"},qe={class:"card-header"},Le={class:"header-actions"},Ae=["innerHTML"],Be=["innerHTML"],Fe={class:"amount"},He={class:"pagination-container"},Pe={class:"order-items-section"},Re={class:"dialog-footer"},Ke={key:0},je={style:{color:"#f56c6c","font-weight":"bold"}},Ge={__name:"Order",setup(Je){const T=_(!1),I=_([]),f=_(""),V=_(1),x=_(10),h=_(!1),z=_(!1),c=_(null),d=se({userId:null,paymentMethod:"wxpay",items:[{productId:null,price:null,quantity:1}]}),N=async()=>{T.value=!0;try{const t=await R({page:1,pageSize:1});if(t&&t.data){const e=t.data.totalCount||0;if(e>0){const n=await R({page:1,pageSize:e});n&&n.data&&(I.value=n.data.orders||[])}else I.value=[]}else I.value=[]}catch(t){console.error("èŽ·å–åˆ—è¡¨å¤±è´¥",t),m.error("èŽ·å–è®¢å•åˆ—è¡¨å¤±è´¥")}finally{T.value=!1}},U=P(()=>{if(!f.value)return I.value;const t=f.value.trim().toLowerCase();return I.value.filter(e=>{const n=e.orderId&&e.orderId.toLowerCase().includes(t),r=e.userId&&String(e.userId).includes(t);return n||r})}),G=P(()=>{const t=(V.value-1)*x.value,e=t+x.value;return U.value.slice(t,e)}),$=t=>{if(t==null)return"";const e=String(t);if(!f.value||!f.value.trim())return e;const n=f.value.trim(),r=new RegExp(n,"gi");return e.replace(r,s=>`<span style="color: red; font-weight: bold; background-color: #ffeb3b;">${s}</span>`)},S=()=>{f.value="",V.value=1},J=t=>{if(t.status!==1&&t.status!==5){m.warning("å½“å‰è®¢å•çŠ¶æ€ä¸å¯åˆ é™¤");return}Oe.confirm(`ç¡®å®šè¦åˆ é™¤è®¢å• ${t.orderId} å—ï¼Ÿ`,"åˆ é™¤ç¡®è®¤",{type:"warning"}).then(async()=>{try{await Ue(t.orderId),m.success("åˆ é™¤æˆåŠŸ"),N()}catch(e){console.error(e),m.error("åˆ é™¤å¤±è´¥")}}).catch(()=>{})},Q=async t=>{try{const e=await Ne(t.orderId);e&&e.data?(c.value=e.data,z.value=!0):m.error(e.message||"èŽ·å–è¯¦æƒ…å¤±è´¥")}catch(e){console.error(e),m.error("èŽ·å–è®¢å•è¯¦æƒ…å¼‚å¸¸")}},W=()=>{d.userId=null,d.items=[{productId:null,price:null,quantity:1}],h.value=!0,console.log("æ‰“å¼€æ–°å»ºè®¢å•å¼¹çª—",d)},X=()=>{d.items.push({productId:null,price:null,quantity:1})},Y=t=>{d.items.splice(t,1)},Z=async()=>{if(!d.userId)return m.warning("è¯·è¾“å…¥å®¢æˆ·ID");for(const t of d.items)if(!t.productId||!t.price)return m.warning("è¯·è¡¥å…¨å•†å“IDå’Œå•ä»·");try{const t=d.items.reduce((r,s)=>r+Number(s.price)*Number(s.quantity),0),e={userId:Number(d.userId),paymentMethod:d.paymentMethod,totalAmount:t,addressId:1,orderItems:d.items.map(r=>({productId:Number(r.productId),quantity:Number(r.quantity),price:Number(r.price)}))},n=await $e(e);n&&(n.success||n.code===200)?(m.success("è®¢å•åˆ›å»ºæˆåŠŸ"),h.value=!1,N()):m.error(n.message||"åˆ›å»ºå¤±è´¥")}catch(t){console.error(t),m.error("åˆ›å»ºè®¢å•å¼‚å¸¸")}},k=t=>Number(t||0).toFixed(2),q=t=>{if(!Array.isArray(t))return t;const[e,n,r,s,C]=t,y=w=>w<10?"0"+w:w;return`${e}-${y(n)}-${y(r)} ${y(s)}:${y(C)}`},L=t=>({1:"å¾…ä»˜æ¬¾",2:"å·²æ”¯ä»˜",3:"å·²å‘è´§",4:"å·²å®Œæˆ",5:"å·²å–æ¶ˆ"})[t]||`çŠ¶æ€${t}`,A=t=>t===4?"success":t===2||t===3?"primary":t===1?"warning":t===5?"info":"",B=t=>({wxpay:"å¾®ä¿¡æ”¯ä»˜",alipay:"æ”¯ä»˜å®",credit_card:"ä¿¡ç”¨å¡"})[t]||t||"-";return de(()=>{N()}),(t,e)=>{const n=ve,r=_e,s=me,C=fe,y=ce,w=ge,ee=ue,F=Ve,O=ke,te=xe,le=Me,ae=we,H=ie,g=ze,oe=Te,re=ye;return b(),M("div",Se,[e[19]||(e[19]=i("h2",null,"ðŸ“‹ è®¢å•åˆ—è¡¨",-1)),l(ee,{shadow:"never"},{header:o(()=>[i("div",qe,[e[11]||(e[11]=i("span",null,"è®¢å•ç®¡ç†",-1)),i("div",Le,[l(n,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=a=>f.value=a),placeholder:"è¯·è¾“å…¥è®¢å•å·/å®¢æˆ·ID",style:{width:"250px","margin-right":"10px"},clearable:"",onClear:S},null,8,["modelValue"]),l(r,{type:"primary",icon:E(be)},{default:o(()=>[...e[8]||(e[8]=[u("æœç´¢ (è‡ªåŠ¨è¿‡æ»¤)",-1)])]),_:1},8,["icon"]),l(r,{icon:E(Ie),onClick:S},{default:o(()=>[...e[9]||(e[9]=[u("é‡ç½®",-1)])]),_:1},8,["icon"]),l(r,{type:"success",icon:E(he),onClick:W,style:{"margin-left":"10px"}},{default:o(()=>[...e[10]||(e[10]=[u("æ–°å»ºè®¢å•",-1)])]),_:1},8,["icon"])])])]),default:o(()=>[pe((b(),K(y,{data:G.value,stripe:"",style:{width:"100%"},"empty-text":"æš‚æ— è®¢å•æ•°æ®"},{default:o(()=>[l(s,{label:"è®¢å•å·",width:"200"},{default:o(({row:a})=>[i("span",{innerHTML:$(a.orderId)},null,8,Ae)]),_:1}),l(s,{label:"å®¢æˆ·ID",width:"120"},{default:o(({row:a})=>[i("span",{innerHTML:$(String(a.userId))},null,8,Be)]),_:1}),l(s,{prop:"totalAmount",label:"æ€»é‡‘é¢",width:"120"},{default:o(({row:a})=>[i("span",Fe,"Â¥"+p(k(a.totalAmount)),1)]),_:1}),l(s,{prop:"paymentMethod",label:"æ”¯ä»˜æ–¹å¼",width:"120"},{default:o(({row:a})=>[u(p(B(a.paymentMethod)),1)]),_:1}),l(s,{prop:"status",label:"çŠ¶æ€",width:"100"},{default:o(({row:a})=>[l(C,{type:A(a.status),size:"small"},{default:o(()=>[u(p(L(a.status)),1)]),_:2},1032,["type"])]),_:1}),l(s,{prop:"createdAt",label:"åˆ›å»ºæ—¶é—´",width:"180"},{default:o(({row:a})=>[u(p(q(a.createdAt)),1)]),_:1}),l(s,{label:"æ“ä½œ",width:"150",fixed:"right"},{default:o(({row:a})=>[l(r,{link:"",type:"primary",size:"small",onClick:D=>Q(a)},{default:o(()=>[...e[12]||(e[12]=[u("æŸ¥çœ‹",-1)])]),_:1},8,["onClick"]),l(r,{link:"",type:"danger",size:"small",disabled:![1,5].includes(a.status),onClick:D=>J(a)},{default:o(()=>[...e[13]||(e[13]=[u(" åˆ é™¤ ",-1)])]),_:1},8,["disabled","onClick"])]),_:1})]),_:1},8,["data"])),[[re,T.value]]),i("div",He,[l(w,{"current-page":V.value,"onUpdate:currentPage":e[1]||(e[1]=a=>V.value=a),"page-size":x.value,"onUpdate:pageSize":e[2]||(e[2]=a=>x.value=a),"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",total:U.value.length},null,8,["current-page","page-size","total"])])]),_:1}),l(H,{modelValue:h.value,"onUpdate:modelValue":e[6]||(e[6]=a=>h.value=a),title:"æ–°å»ºè®¢å•",width:"600px"},{footer:o(()=>[i("span",Re,[l(r,{onClick:e[5]||(e[5]=a=>h.value=!1)},{default:o(()=>[...e[16]||(e[16]=[u("å–æ¶ˆ",-1)])]),_:1}),l(r,{type:"primary",onClick:Z},{default:o(()=>[...e[17]||(e[17]=[u("ç¡®å®šåˆ›å»º",-1)])]),_:1})])]),default:o(()=>[l(ae,{model:d,"label-width":"80px"},{default:o(()=>[l(F,{label:"å®¢æˆ·ID"},{default:o(()=>[l(n,{modelValue:d.userId,"onUpdate:modelValue":e[3]||(e[3]=a=>d.userId=a),modelModifiers:{number:!0},type:"number",placeholder:"è¯·è¾“å…¥å®¢æˆ·ID (ä¾‹å¦‚: 1001)"},null,8,["modelValue"])]),_:1}),l(F,{label:"æ”¯ä»˜æ–¹å¼"},{default:o(()=>[l(te,{modelValue:d.paymentMethod,"onUpdate:modelValue":e[4]||(e[4]=a=>d.paymentMethod=a),placeholder:"è¯·é€‰æ‹©"},{default:o(()=>[l(O,{label:"å¾®ä¿¡æ”¯ä»˜",value:"wxpay"}),l(O,{label:"æ”¯ä»˜å®",value:"alipay"}),l(O,{label:"ä¿¡ç”¨å¡",value:"credit_card"})]),_:1},8,["modelValue"])]),_:1}),i("div",Pe,[e[15]||(e[15]=i("div",{style:{"margin-bottom":"10px","font-weight":"bold",color:"#606266"}},"è®¢å•å•†å“",-1)),(b(!0),M(Ce,null,De(d.items,(a,D)=>(b(),M("div",{key:D,class:"item-row"},[l(n,{modelValue:a.productId,"onUpdate:modelValue":v=>a.productId=v,modelModifiers:{number:!0},type:"number",placeholder:"å•†å“ID",style:{width:"140px"}},null,8,["modelValue","onUpdate:modelValue"]),l(n,{modelValue:a.price,"onUpdate:modelValue":v=>a.price=v,modelModifiers:{number:!0},type:"number",placeholder:"å•ä»·",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue"]),l(le,{modelValue:a.quantity,"onUpdate:modelValue":v=>a.quantity=v,min:1,style:{width:"120px"},placeholder:"æ•°é‡"},null,8,["modelValue","onUpdate:modelValue"]),d.items.length>1?(b(),K(r,{key:0,type:"danger",link:"",icon:E(Ee),onClick:v=>Y(D)},null,8,["icon","onClick"])):j("",!0)]))),128)),l(r,{type:"primary",link:"",size:"small",onClick:X},{default:o(()=>[...e[14]||(e[14]=[u("+ æ·»åŠ å•†å“è¡Œ",-1)])]),_:1})])]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(H,{modelValue:z.value,"onUpdate:modelValue":e[7]||(e[7]=a=>z.value=a),title:"è®¢å•è¯¦æƒ…",width:"700px"},{default:o(()=>[c.value?(b(),M("div",Ke,[l(oe,{border:"",column:2},{default:o(()=>[l(g,{label:"è®¢å•å·"},{default:o(()=>[u(p(c.value.id||c.value.orderId),1)]),_:1}),l(g,{label:"å®¢æˆ·ID"},{default:o(()=>[u(p(c.value.userId),1)]),_:1}),l(g,{label:"æ€»é‡‘é¢"},{default:o(()=>[i("span",je,"Â¥"+p(k(c.value.totalAmount)),1)]),_:1}),l(g,{label:"çŠ¶æ€"},{default:o(()=>[l(C,{type:A(c.value.status),size:"small"},{default:o(()=>[u(p(L(c.value.status)),1)]),_:1},8,["type"])]),_:1}),l(g,{label:"æ”¯ä»˜æ–¹å¼"},{default:o(()=>[u(p(B(c.value.paymentMethod)),1)]),_:1}),l(g,{label:"ä¸‹å•æ—¶é—´"},{default:o(()=>[u(p(q(c.value.createdAt)),1)]),_:1})]),_:1}),e[18]||(e[18]=i("h4",{style:{"margin-top":"20px","margin-bottom":"10px"}},"å•†å“æ¸…å•",-1)),l(y,{data:c.value.items||[],border:"",style:{width:"100%"},size:"small"},{default:o(()=>[l(s,{prop:"productId",label:"å•†å“ID",width:"80"}),l(s,{prop:"productName",label:"å•†å“åç§°"}),l(s,{prop:"price",label:"å•ä»·",width:"100"},{default:o(({row:a})=>[u("Â¥"+p(k(a.price)),1)]),_:1}),l(s,{prop:"quantity",label:"æ•°é‡",width:"80"}),l(s,{label:"å°è®¡",width:"120"},{default:o(({row:a})=>[u("Â¥"+p(k(a.subtotal||a.price*a.quantity)),1)]),_:1})]),_:1},8,["data"])])):j("",!0)]),_:1},8,["modelValue"])])}}},et=ne(Ge,[["__scopeId","data-v-ad81f5f3"]]);export{et as default};
