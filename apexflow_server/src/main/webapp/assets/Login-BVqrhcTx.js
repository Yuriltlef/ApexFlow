import{b as g,e as h}from"./user-Cl6ZlfFa.js";import{_ as b,c as l,e,ax as w,A as m,ay as c,d as f,G as a,u as d,k as u}from"./index-Ck2FL_5i.js";const L={name:"Login",data(){return{username:"",password:"",isLoading:!1}},methods:{async handleLogin(){if(!this.username||!this.password){a.warning("请输入用户名和密码");return}this.isLoading=!0;try{const o=await g({username:this.username,password:this.password});if(o.data.success){const{token:s,user:i}=o.data.data;d.setToken(s);try{const t=await h();if(t.data.success){const r=t.data.data;d.setUserData(i,r)?(a.success("登录成功"),this.$router.push("/dashboard")):a.error("用户数据保存失败")}else console.warn("获取权限失败，仅保存基本信息"),d.setUserData(i,{}),this.$router.push("/dashboard")}catch(t){console.error("权限接口调用异常",t),d.setUserData(i,{}),this.$router.push("/dashboard")}}else a.error(o.data.message||"登录失败")}catch(o){o.status==401?a.error("用户名或密码错误"):(console.error(o),a.error("登录请求异常"))}finally{this.isLoading=!1}}}},_={class:"login-container"},v={class:"content"},y={class:"login-card"},k={class:"form-group"},x={class:"form-group"},U=["disabled"],D={key:0},M={key:1};function V(o,s,i,t,r,p){return u(),l("div",_,[s[7]||(s[7]=e("div",{class:"background-anim"},null,-1)),e("main",v,[e("div",y,[s[5]||(s[5]=e("div",{class:"brand"},[e("h1",{class:"animate-title"},"ApexFlow"),e("p",null,"登录管理控制台")],-1)),e("form",{class:"login-form",onSubmit:s[2]||(s[2]=w((...n)=>p.handleLogin&&p.handleLogin(...n),["prevent"]))},[e("div",k,[s[3]||(s[3]=e("label",{for:"username"},"用户名",-1)),m(e("input",{type:"text",id:"username","onUpdate:modelValue":s[0]||(s[0]=n=>r.username=n),placeholder:"请输入用户名",required:"",autocomplete:"username"},null,512),[[c,r.username]])]),e("div",x,[s[4]||(s[4]=e("label",{for:"password"},"密码",-1)),m(e("input",{type:"password",id:"password","onUpdate:modelValue":s[1]||(s[1]=n=>r.password=n),placeholder:"请输入密码",required:"",autocomplete:"current-password"},null,512),[[c,r.password]])]),e("button",{type:"submit",class:"btn primary",disabled:r.isLoading},[r.isLoading?f("",!0):(u(),l("span",D,"立即登录")),r.isLoading?(u(),l("span",M,"登录中...")):f("",!0)],8,U)],32),s[6]||(s[6]=e("div",{class:"card-footer"},[e("span",{class:"prompt"},"还没有账号?"),e("a",{href:"https://github.com/Yuriltlef",target:"_blank",class:"register-link"},"联系管理员")],-1))])])])}const q=b(L,[["render",V],["__scopeId","data-v-9bdde28f"]]);export{q as default};
