import{_ as M,r as b,a as N,o as F,b as L,c as U,e,f as a,w as o,h as V,j as B,G as $,k as j,q,i as G,E as T,l as m,y as X,t as g,x as H,a2 as J,a3 as K,A as x,F as P}from"./index-DD_-ku_t.js";/* empty css                *//* empty css               */import{i as C}from"./index-CiU0J0Xr.js";const Q={class:"order-analysis"},W={class:"analysis-card"},Y={class:"card-icon blue-bg"},Z={class:"card-content"},tt={class:"card-value"},et={class:"analysis-card"},at={class:"card-icon green-bg"},st={class:"card-content"},ot={class:"card-value"},nt={class:"analysis-card"},rt={class:"card-icon orange-bg"},lt={class:"card-content"},it={class:"card-value"},dt={class:"analysis-card"},ct={class:"card-icon purple-bg"},ut={class:"card-content"},_t={class:"card-value"},pt={__name:"OrderAnalysis",setup(vt){const f=b(!1),y=b(null),w=b(null);let _=null,p=null;const d=N({totalOrders:0,totalSales:0,avgOrderValue:0,activeUsers:0}),O=async()=>{f.value=!0;try{const s=await B();if(s&&s.data&&s.data.orders){const t=s.data.orders;z(t),E(t)}}catch(s){console.error("èŽ·å–åˆ†æžæ•°æ®å¤±è´¥",s),$.error("æ— æ³•åŠ è½½åˆ†æžæ•°æ®")}finally{f.value=!1}},z=s=>{d.totalOrders=s.length;const t=s.reduce((r,i)=>r+(Number(i.totalAmount)||0),0);d.totalSales=t,d.avgOrderValue=s.length>0?t/s.length:0;const l=new Set(s.map(r=>r.userId));d.activeUsers=l.size},E=s=>{if(!s||s.length===0)return;const t=new Map;s.forEach(n=>{let u="";if(Array.isArray(n.createdAt)){const[R,k,I]=n.createdAt;u=`${R}-${String(k).padStart(2,"0")}-${String(I).padStart(2,"0")}`}else typeof n.createdAt=="string"&&(u=n.createdAt.substring(0,10));t.has(u)||t.set(u,{amount:0,count:0});const v=t.get(u);v.amount+=Number(n.totalAmount||0),v.count+=1});const l=Array.from(t.keys()).sort(),r=l.map(n=>t.get(n).amount.toFixed(2)),i=l.map(n=>t.get(n).count);y.value&&(_=C(y.value),_.setOption({tooltip:{trigger:"axis"},legend:{data:["é”€å”®é¢","è®¢å•æ•°"],top:0,right:10},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:l},yAxis:[{type:"value",name:"é‡‘é¢ (Â¥)"},{type:"value",name:"å•é‡"}],series:[{name:"é”€å”®é¢",type:"line",smooth:!0,itemStyle:{color:"#52c41a"},areaStyle:{color:"rgba(82, 196, 26, 0.1)"},data:r},{name:"è®¢å•æ•°",type:"line",yAxisIndex:1,smooth:!0,itemStyle:{color:"#1890ff"},data:i}]}));const h={1:"å¾…ä»˜æ¬¾",2:"å·²æ”¯ä»˜",3:"å·²å‘è´§",4:"å·²å®Œæˆ",5:"å·²å–æ¶ˆ"},c={};s.forEach(n=>{const u=n.status,v=h[u]||"æœªçŸ¥";c[v]=(c[v]||0)+1});const D=Object.keys(c).map(n=>({name:n,value:c[n]}));w.value&&(p=C(w.value),p.setOption({tooltip:{trigger:"item"},legend:{orient:"vertical",right:0,top:20},series:[{name:"è®¢å•çŠ¶æ€",type:"pie",radius:"70%",center:["40%","50%"],data:D,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}))},A=s=>Number(s||0).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}),S=()=>{_&&_.resize(),p&&p.resize()};return F(()=>{O(),window.addEventListener("resize",S)}),L(()=>{window.removeEventListener("resize",S),_&&_.dispose(),p&&p.dispose()}),(s,t)=>{const l=T,r=G,i=q,h=V,c=P;return j(),U("div",Q,[t[6]||(t[6]=e("h2",null,"ðŸ“Š è®¢å•æ•°æ®åˆ†æž",-1)),a(h,{gutter:20,class:"analysis-cards"},{default:o(()=>[a(i,{span:6},{default:o(()=>[a(r,{shadow:"hover"},{default:o(()=>[e("div",W,[e("div",Y,[a(l,{size:"24"},{default:o(()=>[a(m(X))]),_:1})]),e("div",Z,[e("div",tt,g(d.totalOrders),1),t[0]||(t[0]=e("div",{class:"card-label"},"æ€»è®¢å•æ•°",-1))])])]),_:1})]),_:1}),a(i,{span:6},{default:o(()=>[a(r,{shadow:"hover"},{default:o(()=>[e("div",et,[e("div",at,[a(l,{size:"24"},{default:o(()=>[a(m(H))]),_:1})]),e("div",st,[e("div",ot,"Â¥"+g(A(d.totalSales)),1),t[1]||(t[1]=e("div",{class:"card-label"},"æ€»é”€å”®é¢",-1))])])]),_:1})]),_:1}),a(i,{span:6},{default:o(()=>[a(r,{shadow:"hover"},{default:o(()=>[e("div",nt,[e("div",rt,[a(l,{size:"24"},{default:o(()=>[a(m(J))]),_:1})]),e("div",lt,[e("div",it,"Â¥"+g(A(d.avgOrderValue)),1),t[2]||(t[2]=e("div",{class:"card-label"},"å®¢å•ä»·",-1))])])]),_:1})]),_:1}),a(i,{span:6},{default:o(()=>[a(r,{shadow:"hover"},{default:o(()=>[e("div",dt,[e("div",ct,[a(l,{size:"24"},{default:o(()=>[a(m(K))]),_:1})]),e("div",ut,[e("div",_t,g(d.activeUsers),1),t[3]||(t[3]=e("div",{class:"card-label"},"ä¸‹å•ç”¨æˆ·æ•°",-1))])])]),_:1})]),_:1})]),_:1}),a(h,{gutter:20,style:{"margin-top":"20px"}},{default:o(()=>[a(i,{span:16},{default:o(()=>[a(r,{shadow:"never",class:"chart-card"},{header:o(()=>[...t[4]||(t[4]=[e("div",{class:"card-header"},[e("span",null,"ðŸ“ˆ è¿‘æœŸé”€å”®è¶‹åŠ¿ (Sales Trend)")],-1)])]),default:o(()=>[x(e("div",{ref_key:"trendChartRef",ref:y,style:{width:"100%",height:"350px"}},null,512),[[c,f.value]])]),_:1})]),_:1}),a(i,{span:8},{default:o(()=>[a(r,{shadow:"never",class:"chart-card"},{header:o(()=>[...t[5]||(t[5]=[e("div",{class:"card-header"},[e("span",null,"ðŸ¥§ è®¢å•çŠ¶æ€åˆ†å¸ƒ")],-1)])]),default:o(()=>[x(e("div",{ref_key:"pieChartRef",ref:w,style:{width:"100%",height:"350px"}},null,512),[[c,f.value]])]),_:1})]),_:1})]),_:1})])}}},yt=M(pt,[["__scopeId","data-v-8ace18ee"]]);export{yt as default};
