import{a4 as G,_ as ge,r as y,H as M,a as ye,o as be,c as h,e as u,f as a,w as l,i as ke,I as we,J as Y,G as D,k as _,A as Te,a8 as xe,a9 as he,p as o,B as S,d as b,aa as Se,C as Ve,D as Ae,v as Ie,t as p,g as Ee,F as Ce,K as De,L as Le,E as ze,l as q,M as $e,ab as Me,P as Re,Q as Ne,ac as Pe,ad as He,V as Ue,X as Be,Y as Fe}from"./index-Ck2FL_5i.js";/* empty css                *//* empty css                             *//* empty css                       *//* empty css                      *//* empty css                        *//* empty css                    *//* empty css                 */function W(w){return G({url:"/api/after-sales/list",method:"get",params:w})}function je(w){return G({url:`/api/after-sales/${w}`,method:"get"})}function Ge(w){return G({url:`/api/after-sales/${w.id}/status`,method:"put",data:{status:w.status,remark:w.remark}})}const Ke={class:"aftersales-page"},Je={class:"card-header"},Oe={class:"header-actions"},Qe={key:0,class:"data-stat"},Xe={class:"stat-item"},Ye={key:0,class:"stat-item"},qe={class:"highlight-text"},We=["innerHTML"],Ze=["innerHTML"],et=["innerHTML"],tt={style:{color:"#f56c6c"}},at=["innerHTML"],lt={class:"pagination-container",style:{"margin-top":"20px",display:"flex","justify-content":"flex-end"}},st={style:{color:"red"}},ot={class:"dialog-footer"},nt={key:0},rt={style:{"margin-top":"20px"}},ut={style:{padding:"10px",background:"#f5f7fa","border-radius":"4px"}},it={key:0,style:{"margin-top":"20px"}},dt={style:{padding:"10px",background:"#f0f9eb","border-radius":"4px",color:"#67c23a"}},pt={key:1,style:{"margin-top":"20px"}},ct={__name:"AfterSales",setup(w){const R=y(!1),V=y("pending"),A=y(""),I=y(1),L=y(10),x=y([]),N=async()=>{R.value=!0;try{const t=(async()=>{const n=await W({page:1,pageSize:1,status:null,keyword:""});if(n&&n.success&&n.data){const d=n.data.totalCount||0;if(d>0){const r=await W({page:1,pageSize:d,status:null,keyword:""});if(r&&r.success&&r.data&&Array.isArray(r.data.data))return r.data.data}}return[]})(),e=(async()=>{const n=await Y({page:1,pageSize:1,keyword:""});let d=0;if(n&&n.success&&n.data&&(d=n.data.totalCount||n.data.total||0),d>0){const r=await Y({page:1,pageSize:d,keyword:""});if(r&&r.success&&r.data){if(Array.isArray(r.data.orders))return r.data.orders;if(Array.isArray(r.data.data))return r.data.data}}return[]})(),[i,g]=await Promise.all([t,e]),v={};Array.isArray(g)&&g.forEach(n=>{const d=n.orderId,r=n.userId;d&&(v[d]=r)}),x.value=i.map(n=>({...n,userId:v[n.orderId]||"-"}))}catch(t){console.error(t),D.error("è·å–æ•°æ®å¤±è´¥"),x.value=[]}finally{R.value=!1}},P=M(()=>{let t=x.value;V.value==="pending"?t=t.filter(i=>i.status===1):V.value==="approved"?t=t.filter(i=>i.status===2):V.value==="completed"&&(t=t.filter(i=>i.status===4));const e=A.value.trim().toLowerCase();return e&&(t=t.filter(i=>{const g=String(i.id||"").toLowerCase(),v=String(i.refundNo||"").toLowerCase(),n=String(i.orderId||"").toLowerCase(),d=String(i.userId||"").toLowerCase(),r=String(i.reason||"").toLowerCase();return g.includes(e)||v.includes(e)||n.includes(e)||d.includes(e)||r.includes(e)})),t}),Z=M(()=>{const t=(I.value-1)*L.value,e=t+L.value;return P.value.slice(t,e)}),z=t=>{if(!t)return"";const e=String(t),i=A.value.trim();if(!i)return e;const g=new RegExp(`(${i})`,"gi");return e.replace(g,'<span style="color: red; font-weight: bold;">$1</span>')},$=t=>x.value.filter(e=>e.status===t).length,ee=()=>{I.value=1},te=()=>{I.value=1},E=y(!1),H=y(!1),f=y(null),m=ye({action:"approve",remark:"",refundAmount:0}),ae=M(()=>f.value?.status===1?"å”®åå®¡æ ¸":"ç¡®è®¤ç»“å•"),le=M(()=>f.value?.status===1?"å®¡æ ¸é€šè¿‡":"ç¡®è®¤å®Œæˆ"),se=t=>{f.value=t,m.action="approve",m.remark="",m.refundAmount=t.refundAmount||t.amount||0,E.value=!0},oe=async()=>{H.value=!0;try{let t=1;m.action==="reject"?t=3:f.value.status===1?t=2:f.value.status===2&&(t=4);const e=await Ge({id:f.value.id,status:t,remark:m.remark});e&&e.success?(D.success("å¤„ç†æˆåŠŸ"),E.value=!1,N()):D.error(e.message||"å¤„ç†å¤±è´¥")}catch(t){console.error(t),D.error("å¤„ç†å¤±è´¥")}finally{H.value=!1}},U=y(!1),c=y(null),ne=async t=>{try{const e=await je(t.id);e&&e.success&&(c.value=e.data,U.value=!0)}catch{D.error("è·å–è¯¦æƒ…å¤±è´¥")}},B=t=>Number(t||0).toFixed(2),F=t=>{if(!t)return"-";if(Array.isArray(t)){const[e,i,g,v,n]=t,d=r=>r<10?"0"+r:r;return`${e}-${d(i)}-${d(g)} ${d(v)}:${d(n)}`}return t},K=t=>({1:"é€€è´§",2:"æ¢è´§",3:"ç»´ä¿®"})[t]||t||"æœªçŸ¥",re=t=>t===1?"danger":t===2?"warning":t===3?"primary":"",J=t=>({1:"ç”³è¯·ä¸­",2:"å®¡æ ¸é€šè¿‡",3:"å®¡æ ¸æ‹’ç»",4:"å·²å®Œæˆ"})[t]||`çŠ¶æ€${t}`,O=t=>t===4?"success":t===3?"info":t===2?"warning":t===1?"danger":"";return be(()=>{N()}),(t,e)=>{const i=ze,g=Le,v=Ee,n=Se,d=he,r=xe,k=Ae,j=Ie,ue=Ve,ie=De,de=ke,C=Ne,Q=He,pe=Pe,ce=Ue,fe=Re,X=we,T=Fe,me=Be,ve=Ce;return _(),h("div",Ke,[e[25]||(e[25]=u("h2",null,"ğŸ”„ å”®åç®¡ç†",-1)),a(de,{shadow:"never"},{header:l(()=>[u("div",Je,[u("div",Oe,[a(g,{modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=s=>A.value=s),placeholder:"æœç´¢å”®åå•å·/è®¢å•å·/ç”¨æˆ·ID",style:{width:"300px","margin-right":"10px"},clearable:"",onInput:te},{prefix:l(()=>[a(i,null,{default:l(()=>[a(q($e))]),_:1})]),_:1},8,["modelValue"]),a(v,{type:"primary",onClick:N},{default:l(()=>[a(i,{style:{"margin-right":"5px"}},{default:l(()=>[a(q(Me))]),_:1}),e[10]||(e[10]=o(" åˆ·æ–°æ•°æ® ",-1))]),_:1}),x.value.length>0?(_(),h("div",Qe,[u("span",Xe,[e[11]||(e[11]=o("æ€»æ•°æ®: ",-1)),u("strong",null,p(x.value.length),1),e[12]||(e[12]=o(" æ¡",-1))]),A.value?(_(),h("span",Ye,[e[13]||(e[13]=o("æœç´¢åŒ¹é…: ",-1)),u("strong",qe,p(P.value.length),1),e[14]||(e[14]=o(" æ¡",-1))])):b("",!0)])):b("",!0)])])]),default:l(()=>[a(r,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=s=>V.value=s),type:"card",onTabChange:ee},{default:l(()=>[a(d,{label:"å¾…å®¡æ ¸",name:"pending"},{label:l(()=>[e[15]||(e[15]=o(" å¾…å®¡æ ¸ ",-1)),$(1)>0?(_(),S(n,{key:0,value:$(1),type:"danger"},null,8,["value"])):b("",!0)]),_:1}),a(d,{label:"å®¡æ ¸é€šè¿‡(å¤„ç†ä¸­)",name:"approved"},{label:l(()=>[e[16]||(e[16]=o(" å¤„ç†ä¸­ ",-1)),$(2)>0?(_(),S(n,{key:0,value:$(2),type:"warning"},null,8,["value"])):b("",!0)]),_:1}),a(d,{label:"å·²å®Œæˆ",name:"completed"}),a(d,{label:"å…¨éƒ¨",name:"all"})]),_:1},8,["modelValue"]),Te((_(),S(ue,{data:Z.value,stripe:"",style:{width:"100%","margin-top":"10px"},"empty-text":"æš‚æ— ç›¸å…³æ•°æ®"},{default:l(()=>[a(k,{label:"å”®åå•å·/ID",width:"140"},{default:l(({row:s})=>[u("span",{innerHTML:z(s.refundNo||String(s.id))},null,8,We)]),_:1}),a(k,{label:"å…³è”è®¢å•",width:"180"},{default:l(({row:s})=>[u("span",{innerHTML:z(s.orderId)},null,8,Ze)]),_:1}),a(k,{label:"ç”¨æˆ·ID",width:"120"},{default:l(({row:s})=>[u("span",{innerHTML:z(s.userId||"-")},null,8,et)]),_:1}),a(k,{prop:"type",label:"å”®åç±»å‹",width:"100"},{default:l(({row:s})=>[a(j,{type:re(s.type),size:"small"},{default:l(()=>[o(p(K(s.type)),1)]),_:2},1032,["type"])]),_:1}),a(k,{prop:"refundAmount",label:"ç”³è¯·é‡‘é¢",width:"120"},{default:l(({row:s})=>[u("span",tt,"Â¥"+p(B(s.refundAmount||s.amount)),1)]),_:1}),a(k,{prop:"reason",label:"ç”³è¯·åŸå› ","min-width":"150","show-overflow-tooltip":""},{default:l(({row:s})=>[u("span",{innerHTML:z(s.reason)},null,8,at)]),_:1}),a(k,{prop:"status",label:"çŠ¶æ€",width:"100"},{default:l(({row:s})=>[a(j,{type:O(s.status),effect:"plain"},{default:l(()=>[o(p(J(s.status)),1)]),_:2},1032,["type"])]),_:1}),a(k,{prop:"createTime",label:"ç”³è¯·æ—¶é—´",width:"170"},{default:l(({row:s})=>[o(p(F(s.createTime||s.applyTime)),1)]),_:1}),a(k,{label:"æ“ä½œ",width:"150",fixed:"right"},{default:l(({row:s})=>[[1,2].includes(s.status)?(_(),S(v,{key:0,type:"primary",size:"small",link:"",onClick:_e=>se(s)},{default:l(()=>[o(p(s.status===1?"å®¡æ ¸":"ç»“å•"),1)]),_:2},1032,["onClick"])):b("",!0),a(v,{type:"info",size:"small",link:"",onClick:_e=>ne(s)},{default:l(()=>[...e[17]||(e[17]=[o("æŸ¥çœ‹",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ve,R.value]]),u("div",lt,[a(ie,{"current-page":I.value,"onUpdate:currentPage":e[2]||(e[2]=s=>I.value=s),"page-size":L.value,"onUpdate:pageSize":e[3]||(e[3]=s=>L.value=s),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",total:P.value.length},null,8,["current-page","page-size","total"])])]),_:1}),a(X,{modelValue:E.value,"onUpdate:modelValue":e[8]||(e[8]=s=>E.value=s),title:ae.value,width:"500px"},{footer:l(()=>[u("span",ot,[a(v,{onClick:e[7]||(e[7]=s=>E.value=!1)},{default:l(()=>[...e[20]||(e[20]=[o("å–æ¶ˆ",-1)])]),_:1}),a(v,{type:"primary",loading:H.value,onClick:oe},{default:l(()=>[...e[21]||(e[21]=[o("ç¡®è®¤å¤„ç†",-1)])]),_:1},8,["loading"])])]),default:l(()=>[a(fe,{ref:"processFormRef",model:m,"label-width":"80px"},{default:l(()=>[a(C,{label:"å”®åå•å·"},{default:l(()=>[u("span",null,p(f.value?.refundNo||f.value?.id),1)]),_:1}),a(C,{label:"ç”³è¯·é‡‘é¢"},{default:l(()=>[u("span",st,"Â¥"+p(B(f.value?.refundAmount||f.value?.amount)),1)]),_:1}),a(C,{label:"å¤„ç†ç»“æœ",prop:"action"},{default:l(()=>[a(pe,{modelValue:m.action,"onUpdate:modelValue":e[4]||(e[4]=s=>m.action=s)},{default:l(()=>[a(Q,{label:"approve"},{default:l(()=>[o(p(le.value),1)]),_:1}),f.value?.status===1?(_(),S(Q,{key:0,label:"reject"},{default:l(()=>[...e[18]||(e[18]=[o("æ‹’ç»ç”³è¯·",-1)])]),_:1})):b("",!0)]),_:1},8,["modelValue"])]),_:1}),m.action==="approve"?(_(),S(C,{key:0,label:"é€€æ¬¾é‡‘é¢"},{default:l(()=>[a(ce,{modelValue:m.refundAmount,"onUpdate:modelValue":e[5]||(e[5]=s=>m.refundAmount=s),min:0,max:f.value?.refundAmount||f.value?.amount,precision:2},null,8,["modelValue","max"]),e[19]||(e[19]=u("div",{style:{"font-size":"12px",color:"#999"}},"ä¸å¾—è¶…è¿‡ç”³è¯·é‡‘é¢",-1))]),_:1})):b("",!0),a(C,{label:"å¤„ç†å¤‡æ³¨"},{default:l(()=>[a(g,{modelValue:m.remark,"onUpdate:modelValue":e[6]||(e[6]=s=>m.remark=s),type:"textarea",rows:"3",placeholder:"è¯·è¾“å…¥å¤„ç†æ„è§"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(X,{modelValue:U.value,"onUpdate:modelValue":e[9]||(e[9]=s=>U.value=s),title:"å”®åè¯¦æƒ…",width:"600px"},{default:l(()=>[c.value?(_(),h("div",nt,[a(me,{border:"",column:2},{default:l(()=>[a(T,{label:"å”®åID"},{default:l(()=>[o(p(c.value.id),1)]),_:1}),a(T,{label:"ç”³è¯·æ—¶é—´"},{default:l(()=>[o(p(F(c.value.applyTime||c.value.createTime)),1)]),_:1}),a(T,{label:"å…³è”è®¢å•"},{default:l(()=>[o(p(c.value.orderId),1)]),_:1}),a(T,{label:"ç”¨æˆ·ID"},{default:l(()=>[o(p(c.value.userId||f.value?.userId||"-"),1)]),_:1}),a(T,{label:"å”®åç±»å‹"},{default:l(()=>[o(p(K(c.value.type)),1)]),_:1}),a(T,{label:"å½“å‰çŠ¶æ€"},{default:l(()=>[a(j,{type:O(c.value.status)},{default:l(()=>[o(p(J(c.value.status)),1)]),_:1},8,["type"])]),_:1}),a(T,{label:"ç”³è¯·é‡‘é¢"},{default:l(()=>[o("Â¥"+p(B(c.value.refundAmount)),1)]),_:1}),a(T,{label:"è”ç³»ç”µè¯"},{default:l(()=>[o(p(c.value.phone||"-"),1)]),_:1})]),_:1}),u("div",rt,[e[22]||(e[22]=u("h4",null,"ç”³è¯·åŸå› ",-1)),u("div",ut,p(c.value.reason),1)]),c.value.processRemark?(_(),h("div",it,[e[23]||(e[23]=u("h4",null,"å¤„ç†å¤‡æ³¨",-1)),u("div",dt,p(c.value.processRemark),1)])):b("",!0),c.value.processTime?(_(),h("div",pt,[e[24]||(e[24]=u("h4",null,"å¤„ç†æ—¶é—´",-1)),u("div",null,p(F(c.value.processTime)),1)])):b("",!0)])):b("",!0)]),_:1},8,["modelValue"])])}}},wt=ge(ct,[["__scopeId","data-v-4306ddb5"]]);export{wt as default};
