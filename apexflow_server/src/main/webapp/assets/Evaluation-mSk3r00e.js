import{a4 as F,_ as oe,r as f,H as D,o as re,c as v,e as n,f as l,w as u,i as ie,G as I,k as r,A as ue,a8 as ce,a9 as de,p as g,B as L,d as h,aa as pe,ae as ge,T as H,U,af as ve,v as _e,t as z,g as me,ag as fe,ah as he,F as ye,K as we,L as be,E as Le,l as A,M as Ee,R as xe,S as Ce,ab as Ie,$ as Te}from"./index-C-PAn4RE.js";/* empty css                *//* empty css                      *//* empty css                        *//* empty css                    *//* empty css                 */function P(E){return F({url:"/api/review",method:"get",params:E})}function ke(E){return F({url:`/api/review/${E}`,method:"delete"})}const Ve={class:"evaluation-page"},Se={class:"card-header"},ze={class:"header-actions"},Me={key:0,class:"data-stat"},$e={class:"stat-item"},Re={key:0,class:"stat-item"},Be={class:"highlight-text"},De={class:"evaluation-list"},He={class:"evaluation-header"},Ue={class:"evaluation-info"},Ae={class:"user-meta"},Pe={class:"customer-name"},Fe=["innerHTML"],Ne={class:"meta-sub"},Ke={class:"product-name"},je=["innerHTML"],Ge={class:"order-no"},Oe=["innerHTML"],We={class:"evaluation-right"},qe={class:"evaluation-time"},Je={class:"rating-bar"},Qe=["innerHTML"],Xe={key:0,class:"evaluation-images"},Ye={class:"pagination-container"},Ze={__name:"Evaluation",setup(E){const T=f(!1),x=f("all"),y=f(""),w=f(""),d=f(1),b=f(10),c=f([]),M=async()=>{T.value=!0;try{const t=await P({page:1,pageSize:1});if(t&&t.success&&t.data){const e=t.data.total||0;if(e>0){const a=await P({page:1,pageSize:e});if(a&&a.success&&a.data){const i=a.data.reviews||[];c.value=i.map(o=>({...o,imageList:o.images?o.images.split(",").filter(_=>_.trim()):[]}))}}else c.value=[]}else c.value=[]}catch(t){console.error(t),I.error("获取评价列表失败")}finally{T.value=!1}},k=D(()=>{let t=c.value;x.value==="withImages"?t=t.filter(a=>a.imageList&&a.imageList.length>0):x.value==="anonymous"&&(t=t.filter(a=>a.anonymous)),w.value!==""&&(t=t.filter(a=>a.rating===w.value));const e=y.value.trim().toLowerCase();return e&&(t=t.filter(a=>{const i=String(a.userId||"").toLowerCase(),o=String(a.productId||"").toLowerCase(),_=String(a.orderId||"").toLowerCase(),p=String(a.content||"").toLowerCase();return i.includes(e)||o.includes(e)||_.includes(e)||p.includes(e)})),t}),V=D(()=>{const t=(d.value-1)*b.value,e=t+b.value;return k.value.slice(t,e)}),N=()=>{d.value=1},K=()=>{d.value=1},j=()=>{d.value=1},G=()=>{},O=t=>{b.value=t,d.value=1},$=()=>c.value.filter(t=>t.imageList&&t.imageList.length>0).length,R=()=>c.value.filter(t=>t.anonymous).length,S=t=>{if(!t)return"";const e=String(t),a=y.value.trim();if(!a)return e;const i=new RegExp(`(${a})`,"gi");return e.replace(i,'<span style="color: red; font-weight: bold;">$1</span>')},W=t=>{if(!t||t.trim()==="")return'<span style="color: #909399; font-style: italic;">此用户没有填写评价内容。</span>';const e=y.value.trim();if(!e)return t;const a=new RegExp(`(${e})`,"gi");return t.replace(a,'<span style="color: red; font-weight: bold;">$1</span>')},q=t=>{Te.confirm("确定要删除这条评价吗？此操作不可恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e=await ke(t.id);if(e&&e.success){I.success("删除成功");const a=c.value.findIndex(i=>i.id===t.id);a!==-1&&c.value.splice(a,1),V.value.length===0&&d.value>1&&d.value--}else I.error(e.message||"删除失败")}catch{I.error("删除请求失败")}}).catch(()=>{})},J=t=>{if(!t)return"-";if(Array.isArray(t)){const[e,a,i,o,_]=t,p=m=>m<10?"0"+m:m;return`${e}-${p(a)}-${p(i)} ${p(o)}:${p(_)}`}return t.replace("T"," ")};return re(()=>{M()}),(t,e)=>{const a=Le,i=be,o=Ce,_=xe,p=me,m=de,B=pe,Q=ce,X=ge,Y=ve,Z=_e,ee=fe,te=he,ae=we,se=ie,ne=ye;return r(),v("div",Ve,[e[15]||(e[15]=n("h2",null,"⭐ 评价管理",-1)),l(se,{shadow:"never"},{header:u(()=>[n("div",Se,[n("div",ze,[l(i,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=s=>y.value=s),placeholder:"搜索用户ID/商品ID/订单号/评价内容",style:{width:"300px","margin-right":"10px"},clearable:"",onInput:j},{prefix:u(()=>[l(a,null,{default:u(()=>[l(A(Ee))]),_:1})]),_:1},8,["modelValue"]),l(_,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=s=>w.value=s),placeholder:"评分筛选",style:{width:"120px","margin-right":"10px"},clearable:"",onChange:K},{default:u(()=>[l(o,{label:"全部评分",value:""}),l(o,{label:"5星",value:5}),l(o,{label:"4星",value:4}),l(o,{label:"3星",value:3}),l(o,{label:"2星",value:2}),l(o,{label:"1星",value:1})]),_:1},8,["modelValue"]),l(p,{type:"primary",onClick:M},{default:u(()=>[l(a,{style:{"margin-right":"5px"}},{default:u(()=>[l(A(Ie))]),_:1}),e[5]||(e[5]=g(" 刷新 ",-1))]),_:1}),c.value.length>0?(r(),v("div",Me,[n("span",$e,[e[6]||(e[6]=g("总记录: ",-1)),n("strong",null,z(c.value.length),1)]),y.value||w.value?(r(),v("span",Re,[e[7]||(e[7]=g("过滤后: ",-1)),n("strong",Be,z(k.value.length),1)])):h("",!0)])):h("",!0)])])]),default:u(()=>[l(Q,{modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=s=>x.value=s),type:"card",onTabChange:N},{default:u(()=>[l(m,{label:"全部评价",name:"all"}),l(m,{label:"含图片",name:"withImages"},{label:u(()=>[e[8]||(e[8]=g(" 含图片 ",-1)),$()>0?(r(),L(B,{key:0,value:$(),type:"success"},null,8,["value"])):h("",!0)]),_:1}),l(m,{label:"匿名评价",name:"anonymous"},{label:u(()=>[e[9]||(e[9]=g(" 匿名评价 ",-1)),R()>0?(r(),L(B,{key:0,value:R(),type:"info"},null,8,["value"])):h("",!0)]),_:1})]),_:1},8,["modelValue"]),ue((r(),v("div",De,[V.value.length===0?(r(),L(X,{key:0,description:"暂无评价数据"})):h("",!0),(r(!0),v(H,null,U(V.value,s=>(r(),v("div",{key:s.id,class:"evaluation-item"},[n("div",He,[n("div",Ue,[l(Y,{size:36,icon:"UserFilled",class:"user-avatar"}),n("div",Ae,[n("div",Pe,[e[11]||(e[11]=g(" 用户ID: ",-1)),n("span",{innerHTML:S(s.userId)},null,8,Fe),s.anonymous?(r(),L(Z,{key:0,size:"small",type:"info",effect:"plain",style:{"margin-left":"8px"}},{default:u(()=>[...e[10]||(e[10]=[g("匿名",-1)])]),_:1})):h("",!0)]),n("div",Ne,[n("span",Ke,[e[12]||(e[12]=g("商品ID: ",-1)),n("span",{innerHTML:S(s.productId)},null,8,je)]),e[14]||(e[14]=n("span",{class:"separator"},"|",-1)),n("span",Ge,[e[13]||(e[13]=g("订单号: ",-1)),n("span",{innerHTML:S(s.orderId)},null,8,Oe)])])])]),n("div",We,[n("span",qe,z(J(s.createdAt)),1),l(p,{type:"danger",icon:"Delete",circle:"",size:"small",plain:"",onClick:C=>q(s),style:{"margin-left":"15px"}},null,8,["onClick"])])]),n("div",Je,[l(ee,{modelValue:s.rating,"onUpdate:modelValue":C=>s.rating=C,disabled:"","show-score":"","text-color":"#ff9900","score-template":"{value} 分"},null,8,["modelValue","onUpdate:modelValue"])]),n("div",{class:"evaluation-content",innerHTML:W(s.content)},null,8,Qe),s.imageList&&s.imageList.length>0?(r(),v("div",Xe,[(r(!0),v(H,null,U(s.imageList,(C,le)=>(r(),L(te,{key:le,src:C,"preview-src-list":s.imageList,fit:"cover",class:"eval-image"},null,8,["src","preview-src-list"]))),128))])):h("",!0)]))),128))])),[[ne,T.value]]),n("div",Ye,[l(ae,{"current-page":d.value,"onUpdate:currentPage":e[3]||(e[3]=s=>d.value=s),"page-size":b.value,"onUpdate:pageSize":e[4]||(e[4]=s=>b.value=s),"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",total:k.value.length,onSizeChange:O,onCurrentChange:G},null,8,["current-page","page-size","total"])])]),_:1})])}}},ot=oe(Ze,[["__scopeId","data-v-625e5fb1"]]);export{ot as default};
