import{_ as ve,r as f,a as U,c as _,e as r,f as a,w as l,i as ke,I as Ve,k as d,a8 as we,a9 as Ue,P as xe,Q as Ee,L as Ce,ar as Se,B as g,E as Me,l as D,O as W,v as Ae,p as o,g as ze,A as Le,al as Ie,M as Te,C as Be,D as Pe,t as O,d as v,as as Re,F as Fe,K as Ne,at as De,au as Oe,av as $e,ac as je,ad as Ge,T as Ke,U as Qe,aw as qe,G as p,$ as He}from"./index-C-PAn4RE.js";/* empty css                *//* empty css                       *//* empty css                    *//* empty css                        *//* empty css                      */import{g as Je,u as X,d as We,c as Xe,a as Ye,r as Ze}from"./user-DRc8DbjF.js";const he={class:"system-page"},ea={class:"settings-form"},aa=["src"],la={class:"user-management-panel",style:{padding:"20px"}},sa={class:"header-actions"},ta={key:0,style:{color:"#f56c6c","font-size":"12px"}},na={key:1,class:"permission-tags"},oa={key:6,style:{color:"#909399","font-size":"12px"}},ia={class:"pagination-container",style:{"margin-top":"20px",display:"flex","justify-content":"flex-end"}},da={class:"settings-form"},ua={class:"settings-form"},ra={class:"settings-form"},pa={class:"backup-section"},ma={key:0,class:"backup-info"},fa={key:1,class:"admin-tip"},ga={class:"dialog-footer"},ca={__name:"System",setup(ya){const $=f("basic"),I=[{label:"订单管理",key:"canManageOrder"},{label:"物流管理",key:"canManageLogistics"},{label:"售后管理",key:"canManageAfterSales"},{label:"评价管理",key:"canManageReview"},{label:"库存管理",key:"canManageInventory"},{label:"财务管理",key:"canManageIncome"}],c=U({systemName:"ApexFlow 电商管理系统",logoUrl:"",copyright:"© 2023 ApexFlow Team. All Rights Reserved."}),Y=n=>{c.logoUrl=URL.createObjectURL(n.raw)},Z=()=>{p.success("基本设置已保存")},x=U({emailEnabled:!0,systemEnabled:!0}),h=()=>{p.success("通知设置已保存")},T=U({passwordPolicy:["number","special"]}),ee=()=>{p.success("安全设置已保存")},ae=()=>{p.info("查看登录历史功能开发中...")},B=U({lastBackup:""}),P=f(!1),le=()=>{P.value=!0,setTimeout(()=>{P.value=!1,B.lastBackup=new Date().toLocaleString(),p.success("备份创建成功")},1500)},se=()=>{p.warning("恢复备份功能开发中...")},te=n=>{n==="users"&&y()},R=f(!1),j=f([]),G=f(0),k=U({page:1,pageSize:10,keyword:""}),ne=n=>n.canManageOrder||n.canManageLogistics||n.canManageAfterSales||n.canManageReview||n.canManageInventory||n.canManageIncome,y=async()=>{R.value=!0;try{const n=await Je(k);if(n&&n.data&&n.data.success){const e=n.data.data;e&&(j.value=e.users||[],G.value=e.totalCount||0)}}catch(n){console.error("获取列表失败",n)}finally{R.value=!1}},E=f(!1),V=f("create"),F=f(!1),C=f(null),t=U({id:null,username:"",password:"",email:"",status:1,isAdmin:!1,permissions:[]}),oe={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],email:[{type:"email",message:"请输入邮箱",trigger:"blur"}]},K=(n=null)=>{C.value&&C.value.resetFields(),n?(V.value="edit",t.id=n.id,t.username=n.username,t.email=n.email,t.status=n.status,t.password="",t.isAdmin=n.isAdmin,t.permissions=[],n.isAdmin||I.forEach(e=>{n[e.key]&&t.permissions.push(e.key)})):(V.value="create",t.id=null,t.username="",t.password="",t.email="",t.status=1,t.isAdmin=!1,t.permissions=[]),E.value=!0},ie=(n,e)=>{const u={isAdmin:n};return I.forEach(i=>{u[i.key]=n?!0:e.includes(i.key)}),u},de=async()=>{if(C.value){if(V.value==="create"&&!t.password){p.warning("新增用户需设置密码");return}await C.value.validate(async n=>{if(n){F.value=!0;try{const e=ie(t.isAdmin,t.permissions);if(V.value==="create"){const u={realName:t.username,username:t.username,email:t.email,password:t.password,status:t.status,...e};await Xe(u),p.success("创建成功")}else{const u=t.id;await X({id:u,username:t.username,email:t.email,status:t.status}),await Ye({id:u,...e}),t.password&&t.password.trim()!==""&&await Ze(u,t.password.trim()),p.success("更新成功")}E.value=!1,y()}catch(e){console.error(e),p.error("操作失败")}finally{F.value=!1}}})}},ue=n=>{He.confirm(`确定删除用户 ${n.username}?`,"提示",{type:"warning"}).then(async()=>{try{await We(n.id),p.success("删除成功"),y()}catch{p.error("删除失败")}}).catch(()=>{})},re=async n=>{try{await X({id:n.id,status:n.status}),p.success("状态已更新")}catch{n.status=n.status===1?0:1,p.error("更新失败")}};return(n,e)=>{const u=Ce,i=Ee,Q=Me,pe=Se,b=Ae,m=ze,S=xe,M=Ue,w=Pe,N=Re,me=Be,fe=Ne,A=Oe,q=De,H=$e,ge=we,ce=ke,z=Ge,J=je,ye=qe,be=Ve,_e=Fe;return d(),_("div",he,[e[49]||(e[49]=r("h2",null,"⚙️ 系统设置",-1)),a(ce,{class:"settings-card"},{default:l(()=>[a(ge,{modelValue:$.value,"onUpdate:modelValue":e[9]||(e[9]=s=>$.value=s),class:"settings-tabs",onTabChange:te},{default:l(()=>[a(M,{label:"基本设置",name:"basic"},{default:l(()=>[r("div",ea,[a(S,{model:c,"label-width":"120px"},{default:l(()=>[a(i,{label:"系统名称"},{default:l(()=>[a(u,{modelValue:c.systemName,"onUpdate:modelValue":e[0]||(e[0]=s=>c.systemName=s),placeholder:"请输入系统名称"},null,8,["modelValue"])]),_:1}),a(i,{label:"系统Logo"},{default:l(()=>[a(pe,{class:"logo-upload",action:"#","show-file-list":!1,"auto-upload":!1,"on-change":Y},{default:l(()=>[c.logoUrl?(d(),_("img",{key:0,src:c.logoUrl,class:"logo-preview"},null,8,aa)):(d(),g(Q,{key:1,class:"logo-upload-icon"},{default:l(()=>[a(D(W))]),_:1}))]),_:1}),e[18]||(e[18]=r("div",{class:"upload-hint"},"点击上传Logo，建议尺寸 200x60px",-1))]),_:1}),a(i,{label:"版权信息"},{default:l(()=>[a(u,{modelValue:c.copyright,"onUpdate:modelValue":e[1]||(e[1]=s=>c.copyright=s),type:"textarea",rows:3,placeholder:"请输入版权信息"},null,8,["modelValue"])]),_:1}),a(i,{label:"系统版本"},{default:l(()=>[a(b,null,{default:l(()=>[...e[19]||(e[19]=[o("v1.0.0",-1)])]),_:1})]),_:1}),a(i,null,{default:l(()=>[a(m,{type:"primary",onClick:Z},{default:l(()=>[...e[20]||(e[20]=[o("保存基本设置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1}),a(M,{label:"用户管理",name:"users"},{default:l(()=>[r("div",la,[r("div",sa,[a(u,{modelValue:k.keyword,"onUpdate:modelValue":e[2]||(e[2]=s=>k.keyword=s),placeholder:"搜索用户名",style:{width:"250px","margin-right":"10px"},clearable:"",onClear:y,onKeyup:Ie(y,["enter"])},{prefix:l(()=>[a(Q,null,{default:l(()=>[a(D(Te))]),_:1})]),_:1},8,["modelValue"]),a(m,{type:"primary",onClick:y},{default:l(()=>[...e[21]||(e[21]=[o("搜索",-1)])]),_:1}),a(m,{type:"success",icon:D(W),onClick:e[3]||(e[3]=s=>K())},{default:l(()=>[...e[22]||(e[22]=[o("新建用户",-1)])]),_:1},8,["icon"])]),Le((d(),g(me,{data:j.value,stripe:"",style:{width:"100%","margin-top":"20px"},"empty-text":"暂无用户数据"},{default:l(()=>[a(w,{prop:"id",label:"ID",width:"80"}),a(w,{prop:"username",label:"用户名",width:"150"}),a(w,{prop:"email",label:"邮箱","min-width":"180"}),a(w,{label:"角色类型",width:"120"},{default:l(({row:s})=>[a(b,{type:s.isAdmin?"danger":"success"},{default:l(()=>[o(O(s.isAdmin?"超级管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),a(w,{label:"权限概览","min-width":"200"},{default:l(({row:s})=>[s.isAdmin?(d(),_("span",ta,"拥有所有系统权限")):(d(),_("div",na,[s.canManageOrder?(d(),g(b,{key:0,size:"small",type:"info"},{default:l(()=>[...e[23]||(e[23]=[o("订单",-1)])]),_:1})):v("",!0),s.canManageLogistics?(d(),g(b,{key:1,size:"small",type:"info"},{default:l(()=>[...e[24]||(e[24]=[o("物流",-1)])]),_:1})):v("",!0),s.canManageAfterSales?(d(),g(b,{key:2,size:"small",type:"info"},{default:l(()=>[...e[25]||(e[25]=[o("售后",-1)])]),_:1})):v("",!0),s.canManageReview?(d(),g(b,{key:3,size:"small",type:"info"},{default:l(()=>[...e[26]||(e[26]=[o("评价",-1)])]),_:1})):v("",!0),s.canManageInventory?(d(),g(b,{key:4,size:"small",type:"info"},{default:l(()=>[...e[27]||(e[27]=[o("库存",-1)])]),_:1})):v("",!0),s.canManageIncome?(d(),g(b,{key:5,size:"small",type:"info"},{default:l(()=>[...e[28]||(e[28]=[o("财务",-1)])]),_:1})):v("",!0),ne(s)?v("",!0):(d(),_("span",oa,"无权限"))]))]),_:1}),a(w,{prop:"status",label:"状态",width:"100"},{default:l(({row:s})=>[a(N,{modelValue:s.status,"onUpdate:modelValue":L=>s.status=L,"active-value":1,"inactive-value":0,onChange:L=>re(s)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(w,{label:"操作",width:"150",fixed:"right"},{default:l(({row:s})=>[a(m,{link:"",type:"primary",size:"small",onClick:L=>K(s)},{default:l(()=>[...e[29]||(e[29]=[o("编辑",-1)])]),_:1},8,["onClick"]),a(m,{link:"",type:"danger",size:"small",onClick:L=>ue(s)},{default:l(()=>[...e[30]||(e[30]=[o("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[_e,R.value]]),r("div",ia,[a(fe,{"current-page":k.page,"onUpdate:currentPage":e[4]||(e[4]=s=>k.page=s),"page-size":k.pageSize,"onUpdate:pageSize":e[5]||(e[5]=s=>k.pageSize=s),"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",total:G.value,onSizeChange:y,onCurrentChange:y},null,8,["current-page","page-size","total"])])])]),_:1}),a(M,{label:"通知设置",name:"notification"},{default:l(()=>[r("div",da,[a(S,{model:x,"label-width":"120px"},{default:l(()=>[a(i,{label:"邮件通知"},{default:l(()=>[a(N,{modelValue:x.emailEnabled,"onUpdate:modelValue":e[6]||(e[6]=s=>x.emailEnabled=s)},null,8,["modelValue"]),e[31]||(e[31]=r("span",{class:"setting-desc"},"开启后将通过邮件接收重要通知",-1))]),_:1}),a(i,{label:"系统消息"},{default:l(()=>[a(N,{modelValue:x.systemEnabled,"onUpdate:modelValue":e[7]||(e[7]=s=>x.systemEnabled=s)},null,8,["modelValue"]),e[32]||(e[32]=r("span",{class:"setting-desc"},"开启后将在系统内接收通知消息",-1))]),_:1}),a(i,null,{default:l(()=>[a(m,{type:"primary",onClick:h},{default:l(()=>[...e[33]||(e[33]=[o("保存通知设置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1}),a(M,{label:"安全设置",name:"security"},{default:l(()=>[r("div",ua,[a(S,{model:T,"label-width":"120px"},{default:l(()=>[a(i,{label:"密码策略"},{default:l(()=>[a(q,{modelValue:T.passwordPolicy,"onUpdate:modelValue":e[8]||(e[8]=s=>T.passwordPolicy=s)},{default:l(()=>[a(A,{label:"uppercase"},{default:l(()=>[...e[34]||(e[34]=[o("强制大写字母",-1)])]),_:1}),a(A,{label:"number"},{default:l(()=>[...e[35]||(e[35]=[o("强制数字",-1)])]),_:1}),a(A,{label:"special"},{default:l(()=>[...e[36]||(e[36]=[o("强制特殊字符",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"登录历史"},{default:l(()=>[a(m,{type:"info",plain:"",onClick:ae},{default:l(()=>[...e[37]||(e[37]=[o("查看最近登录记录",-1)])]),_:1})]),_:1}),a(i,null,{default:l(()=>[a(m,{type:"primary",onClick:ee},{default:l(()=>[...e[38]||(e[38]=[o("保存安全设置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1}),a(M,{label:"备份与恢复",name:"backup"},{default:l(()=>[r("div",ra,[a(S,{"label-width":"120px"},{default:l(()=>[a(i,{label:"数据备份"},{default:l(()=>[r("div",pa,[a(m,{type:"primary",loading:P.value,onClick:le},{default:l(()=>[...e[39]||(e[39]=[o("立即备份",-1)])]),_:1},8,["loading"]),B.lastBackup?(d(),_("p",ma," 上次备份时间: "+O(B.lastBackup),1)):v("",!0)])]),_:1}),a(H),a(i,{label:"数据恢复"},{default:l(()=>[a(m,{type:"warning",plain:"",onClick:se},{default:l(()=>[...e[40]||(e[40]=[o("恢复备份数据",-1)])]),_:1}),e[41]||(e[41]=r("div",{class:"upload-hint"},"请谨慎操作，恢复后现有数据将被覆盖",-1))]),_:1})]),_:1})])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(be,{modelValue:E.value,"onUpdate:modelValue":e[17]||(e[17]=s=>E.value=s),title:V.value==="create"?"新建用户":"编辑用户",width:"600px","append-to-body":""},{footer:l(()=>[r("span",ga,[a(m,{onClick:e[16]||(e[16]=s=>E.value=!1)},{default:l(()=>[...e[47]||(e[47]=[o("取消",-1)])]),_:1}),a(m,{type:"primary",onClick:de,loading:F.value},{default:l(()=>[...e[48]||(e[48]=[o("确定",-1)])]),_:1},8,["loading"])])]),default:l(()=>[a(S,{ref_key:"userFormRef",ref:C,model:t,rules:oe,"label-width":"100px"},{default:l(()=>[a(i,{label:"用户名",prop:"username"},{default:l(()=>[a(u,{modelValue:t.username,"onUpdate:modelValue":e[10]||(e[10]=s=>t.username=s),disabled:V.value==="edit",placeholder:"请输入登录账号"},null,8,["modelValue","disabled"])]),_:1}),a(i,{label:"密码",prop:"password"},{default:l(()=>[a(u,{modelValue:t.password,"onUpdate:modelValue":e[11]||(e[11]=s=>t.password=s),type:"password","show-password":"",placeholder:V.value==="edit"?"留空则不修改密码":"请输入密码"},null,8,["modelValue","placeholder"])]),_:1}),a(i,{label:"邮箱",prop:"email"},{default:l(()=>[a(u,{modelValue:t.email,"onUpdate:modelValue":e[12]||(e[12]=s=>t.email=s),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),a(i,{label:"状态",prop:"status"},{default:l(()=>[a(J,{modelValue:t.status,"onUpdate:modelValue":e[13]||(e[13]=s=>t.status=s)},{default:l(()=>[a(z,{label:1},{default:l(()=>[...e[42]||(e[42]=[o("启用",-1)])]),_:1}),a(z,{label:0},{default:l(()=>[...e[43]||(e[43]=[o("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(H,{"content-position":"left"},{default:l(()=>[...e[44]||(e[44]=[o("权限设置",-1)])]),_:1}),a(i,{label:"角色类型"},{default:l(()=>[a(J,{modelValue:t.isAdmin,"onUpdate:modelValue":e[14]||(e[14]=s=>t.isAdmin=s)},{default:l(()=>[a(z,{label:!0},{default:l(()=>[...e[45]||(e[45]=[o("超级管理员 (拥有所有权限)",-1)])]),_:1}),a(z,{label:!1},{default:l(()=>[...e[46]||(e[46]=[o("普通用户 (自定义权限)",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t.isAdmin?(d(),_("div",fa,[a(ye,{title:"超级管理员拥有系统内所有模块的操作权限",type:"warning",closable:!1,"show-icon":""})])):(d(),g(i,{key:0,label:"详细权限"},{default:l(()=>[a(q,{modelValue:t.permissions,"onUpdate:modelValue":e[15]||(e[15]=s=>t.permissions=s)},{default:l(()=>[(d(),_(Ke,null,Qe(I,s=>a(A,{key:s.key,label:s.key},{default:l(()=>[o(O(s.label),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},xa=ve(ca,[["__scopeId","data-v-480d5733"]]);export{xa as default};
