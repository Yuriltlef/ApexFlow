import{a4 as B,_ as j,r as V,a as q,o as G,c as p,e as o,f as s,w as u,i as O,G as w,k as c,A as Q,B as b,d as k,ae as H,T as C,U as L,af as J,p as E,t as f,v as W,g as X,ag as Y,ah as Z,F as ee,K as ae,R as te,S as se,L as oe,ai as le,E as ne,l as S,M as re,N as ie,$ as ce}from"./index-DD_-ku_t.js";/* empty css                *//* empty css                      *//* empty css                        */function de(h){return B({url:"/api/review",method:"get",params:h})}function ue(h){return B({url:`/api/review/${h}`,method:"delete"})}const pe={class:"evaluation-page"},_e={class:"card-header"},ge={class:"filter-controls"},ve={class:"evaluation-list"},me={class:"evaluation-header"},fe={class:"evaluation-info"},he={class:"user-meta"},ye={class:"customer-name"},we={class:"meta-sub"},Ee={class:"product-name"},Ie={class:"order-no"},xe={class:"evaluation-right"},ze={class:"evaluation-time"},Ve={class:"rating-bar"},be={class:"evaluation-content"},ke={key:0,class:"evaluation-images"},Ce={class:"pagination-container"},Le={__name:"Evaluation",setup(h){const I=V(!1),_=V([]),x=V(0),t=q({page:1,pageSize:10,productId:"",userId:"",rating:""}),g=async()=>{I.value=!0;try{const n={page:t.page,pageSize:t.pageSize,productId:t.productId||null},e=await de(n);if(e&&e.success){const l=e.data;console.log("获取评价列表数据",l);let r=l.reviews||[];r=r.map(i=>({...i,imageList:i.images?i.images.split(","):[]})),t.rating&&(r=r.filter(i=>i.rating===t.rating)),_.value=r,x.value=l.total||0}else _.value=[],x.value=0}catch(n){console.error(n),w.error("获取评价列表失败")}finally{I.value=!1}},v=()=>{t.page=1,g()},D=()=>{t.productId="",t.rating="",v()},U=n=>{ce.confirm("确定要删除这条评价吗？此操作不可恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e=await ue(n.id);e&&e.success?(w.success("删除成功"),_.value.length===1&&t.page>1&&t.page--,g()):w.error(e.message||"删除失败")}catch{w.error("删除请求失败")}}).catch(()=>{})},$=n=>{if(!n)return"-";if(Array.isArray(n)){const[e,l,r,i,z]=n,d=m=>m<10?"0"+m:m;return`${e}-${d(l)}-${d(r)} ${d(i)}:${d(z)}`}return n.replace("T"," ")};return G(()=>{g()}),(n,e)=>{const l=se,r=te,i=ne,z=oe,d=X,m=H,T=J,A=W,N=Y,F=Z,M=ae,R=O,K=ee;return c(),p("div",pe,[e[8]||(e[8]=o("h2",null,"⭐ 评价管理",-1)),s(R,{shadow:"never"},{header:u(()=>[o("div",_e,[o("div",ge,[s(r,{modelValue:t.rating,"onUpdate:modelValue":e[0]||(e[0]=a=>t.rating=a),placeholder:"评分筛选",size:"default",style:{width:"120px"},clearable:"",onChange:v},{default:u(()=>[s(l,{label:"全部评分",value:""}),s(l,{label:"5星",value:5}),s(l,{label:"4星",value:4}),s(l,{label:"3星",value:3}),s(l,{label:"2星",value:2}),s(l,{label:"1星",value:1})]),_:1},8,["modelValue"]),s(z,{modelValue:t.productId,"onUpdate:modelValue":e[1]||(e[1]=a=>t.productId=a),placeholder:"输入商品ID搜索",size:"default",style:{width:"200px","margin-left":"10px"},clearable:"",onClear:v,onKeyup:le(v,["enter"])},{prefix:u(()=>[s(i,null,{default:u(()=>[s(S(re))]),_:1})]),_:1},8,["modelValue"]),s(d,{type:"primary",onClick:v,style:{"margin-left":"10px"}},{default:u(()=>[...e[4]||(e[4]=[E("搜索",-1)])]),_:1}),s(d,{icon:S(ie),onClick:D},{default:u(()=>[...e[5]||(e[5]=[E("重置",-1)])]),_:1},8,["icon"])])])]),default:u(()=>[Q((c(),p("div",ve,[_.value.length===0?(c(),b(m,{key:0,description:"暂无评价数据"})):k("",!0),(c(!0),p(C,null,L(_.value,a=>(c(),p("div",{key:a.id,class:"evaluation-item"},[o("div",me,[o("div",fe,[s(T,{size:36,icon:"UserFilled",class:"user-avatar"}),o("div",he,[o("div",ye,[E(" 用户ID: "+f(a.userId)+" ",1),a.anonymous?(c(),b(A,{key:0,size:"small",type:"info",effect:"plain"},{default:u(()=>[...e[6]||(e[6]=[E("匿名",-1)])]),_:1})):k("",!0)]),o("div",we,[o("span",Ee,"商品ID: "+f(a.productId),1),e[7]||(e[7]=o("span",{class:"separator"},"|",-1)),o("span",Ie,"订单号: "+f(a.orderId),1)])])]),o("div",xe,[o("span",ze,f($(a.createdAt)),1),s(d,{type:"danger",icon:"Delete",circle:"",size:"small",plain:"",onClick:y=>U(a),style:{"margin-left":"15px"}},null,8,["onClick"])])]),o("div",Ve,[s(N,{modelValue:a.rating,"onUpdate:modelValue":y=>a.rating=y,disabled:"","show-score":"","text-color":"#ff9900","score-template":"{value} 分"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",be,f(a.content||"此用户没有填写评价内容。"),1),a.imageList&&a.imageList.length>0?(c(),p("div",ke,[(c(!0),p(C,null,L(a.imageList,(y,P)=>(c(),b(F,{key:P,src:y,"preview-src-list":a.imageList,fit:"cover",class:"eval-image"},null,8,["src","preview-src-list"]))),128))])):k("",!0)]))),128))])),[[K,I.value]]),o("div",Ce,[s(M,{"current-page":t.page,"onUpdate:currentPage":e[2]||(e[2]=a=>t.page=a),"page-size":t.pageSize,"onUpdate:pageSize":e[3]||(e[3]=a=>t.pageSize=a),"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",total:x.value,onSizeChange:g,onCurrentChange:g},null,8,["current-page","page-size","total"])])]),_:1})])}}},$e=j(Le,[["__scopeId","data-v-8ba22f9e"]]);export{$e as default};
