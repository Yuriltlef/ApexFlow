import{_ as ce,r as c,a as q,H as O,o as pe,c as U,e as s,f as t,w as l,h as me,i as fe,I as _e,G as g,k as T,q as ge,E as ve,l as V,x as ye,t as m,an as be,ao as he,A as we,B as j,C as ke,D as Ve,v as Ie,p as u,d as L,g as $e,F as Ee,K as xe,L as Se,M as Te,R as Ce,S as Re,ab as Me,O as De,P as ze,Q as Fe,V as Ue,ac as Le,ad as Ne,ap as Be,$ as He}from"./index-C-PAn4RE.js";/* empty css                */import{g as G,a as Pe,u as Ae,d as Ye,b as qe,c as Oe}from"./finance-D-mQez5d.js";/* empty css                       *//* empty css                      *//* empty css                        *//* empty css               */const je={class:"finance-page"},Ge={class:"stat-item"},Ke={class:"stat-icon",style:{color:"#52c41a",background:"#f6ffed"}},Qe={class:"stat-content"},Je={class:"stat-value"},We={class:"stat-item"},Xe={class:"stat-icon",style:{color:"#1890ff",background:"#e6f7ff"}},Ze={class:"stat-content"},et={class:"stat-value"},tt={class:"stat-item"},at={class:"stat-icon",style:{color:"#faad14",background:"#fffbe6"}},lt={class:"stat-content"},ot={class:"stat-value"},st={class:"table-header"},nt={class:"actions"},it={key:0,class:"data-stat"},dt={class:"stat-item"},rt={key:0,class:"stat-item"},ut={class:"highlight-text"},ct=["innerHTML"],pt={style:{color:"#f56c6c","font-weight":"bold"}},mt={class:"pagination-container"},ft={class:"dialog-footer"},_t={__name:"Finance",setup(gt){const D=c(!1),b=c([]),C=c(1),R=c(10),h=c(""),I=c(null),p=q({totalIncome:0,totalRefund:0,netIncome:0}),$=async()=>{D.value=!0;try{const a=await G({page:1,pageSize:1,type:"income"});if(a&&a.success){const i=a.data.totalCount||(a.data.incomes?a.data.incomes.length:0);if(i>0){const n=await G({page:1,pageSize:i,type:"income"});n&&n.success&&(b.value=n.data.incomes||n.data.list||n.data.data||[],n.data.totalIncome!==void 0&&(p.totalIncome=n.data.totalIncome,p.totalRefund=n.data.totalRefund,p.netIncome=n.data.netIncome))}else b.value=[]}const e=await Pe();e&&e.success&&e.data&&(p.totalIncome=e.data.totalIncome,p.totalRefund=e.data.totalRefund,p.netIncome=e.data.netIncome)}catch(a){console.error(a),g.error("èŽ·å–æ•°æ®å¤±è´¥"),b.value=[]}finally{D.value=!1}},z=O(()=>{let a=b.value;if(h.value){const e=h.value.trim().toLowerCase();a=a.filter(i=>String(i.orderId).toLowerCase().includes(e))}return I.value&&(a=a.filter(e=>e.status===I.value)),a}),K=O(()=>{const a=(C.value-1)*R.value,e=a+R.value;return z.value.slice(a,e)}),N=()=>{C.value=1},Q=a=>{if(!a)return"";const e=String(a),i=h.value.trim();if(!i)return e;const n=new RegExp(`(${i})`,"gi");return e.replace(n,'<span style="color: red; font-weight: bold;">$1</span>')},E=c(!1),x=c(!1),F=c(!1),B=c(null),d=q({id:null,orderId:"",amount:0,type:"income",paymentMethod:"alipay",status:1,transactionTime:"",remark:""}),J={orderId:[{required:!0,message:"è¯·è¾“å…¥è®¢å•å·",trigger:"blur"}],amount:[{required:!0,message:"è¯·è¾“å…¥é‡‘é¢",trigger:"blur"}],transactionTime:[{required:!0,message:"è¯·é€‰æ‹©æ—¶é—´",trigger:"change"}]},H=(a=null)=>{if(a){if(x.value=!0,Object.assign(d,a),Array.isArray(a.transactionTime)){const[e,i,n,v,S,f]=a.transactionTime,r=w=>(w||0).toString().padStart(2,"0");d.transactionTime=`${e}-${r(i)}-${r(n)} ${r(v)}:${r(S)}:${r(f)}`}}else x.value=!1,Object.assign(d,{id:null,orderId:"",amount:0,type:"income",paymentMethod:"alipay",status:1,transactionTime:W(),remark:""});E.value=!0},W=()=>{const a=new Date,e=i=>i.toString().padStart(2,"0");return`${a.getFullYear()}-${e(a.getMonth()+1)}-${e(a.getDate())} ${e(a.getHours())}:${e(a.getMinutes())}:${e(a.getSeconds())}`},X=async()=>{await B.value.validate(async a=>{if(a){F.value=!0;try{x.value?(await qe(d),g.success("æ›´æ–°æˆåŠŸ")):(await Oe(d),g.success("åˆ›å»ºæˆåŠŸ")),E.value=!1,$()}catch{g.error("æ“ä½œå¤±è´¥")}finally{F.value=!1}}})},Z=async a=>{try{await Ae(a.id,2),g.success("å·²ç¡®è®¤ä¸ºå…¥è´¦çŠ¶æ€"),$()}catch{g.error("æ“ä½œå¤±è´¥")}},ee=a=>{He.confirm("ç¡®å®šåˆ é™¤è¯¥æ¡è®°å½•å—?","è­¦å‘Š",{type:"warning"}).then(async()=>{try{await Ye(a.id),g.success("åˆ é™¤æˆåŠŸ"),$()}catch{g.error("åˆ é™¤å¤±è´¥")}}).catch(()=>{})},M=a=>Number(a||0).toFixed(2),te=a=>{if(!a)return"-";if(Array.isArray(a)){const[e,i,n,v,S,f]=a,r=w=>(w||0).toString().padStart(2,"0");return`${e}-${r(i)}-${r(n)} ${r(v)}:${r(S)}${f!==void 0?":"+r(f):""}`}return String(a).replace("T"," ")},ae=a=>({alipay:"æ”¯ä»˜å®",wxpay:"å¾®ä¿¡",card:"é“¶è¡Œå¡",cash:"çŽ°é‡‘"})[a]||a;return pe(()=>{$()}),(a,e)=>{const i=ve,n=fe,v=ge,S=me,f=Se,r=Re,w=Ce,y=$e,_=Ve,P=Ie,le=ke,oe=xe,k=Fe,se=Ue,A=Ne,ne=Le,ie=Be,de=ze,re=_e,ue=Ee;return T(),U("div",je,[e[27]||(e[27]=s("h2",null,"ðŸ’° æ”¶å…¥ç®¡ç†",-1)),t(S,{gutter:16,class:"finance-stats"},{default:l(()=>[t(v,{span:8},{default:l(()=>[t(n,{shadow:"hover"},{default:l(()=>[s("div",Ge,[s("div",Ke,[t(i,{size:"24"},{default:l(()=>[t(V(ye))]),_:1})]),s("div",Qe,[s("div",Je,"Â¥"+m(M(p.totalIncome)),1),e[13]||(e[13]=s("div",{class:"stat-label"},"æ€»æ”¶å…¥",-1))])])]),_:1})]),_:1}),t(v,{span:8},{default:l(()=>[t(n,{shadow:"hover"},{default:l(()=>[s("div",We,[s("div",Xe,[t(i,{size:"24"},{default:l(()=>[t(V(be))]),_:1})]),s("div",Ze,[s("div",et,"Â¥"+m(M(p.netIncome)),1),e[14]||(e[14]=s("div",{class:"stat-label"},"å‡€æ”¶å…¥ (æ‰£é™¤é€€æ¬¾)",-1))])])]),_:1})]),_:1}),t(v,{span:8},{default:l(()=>[t(n,{shadow:"hover"},{default:l(()=>[s("div",tt,[s("div",at,[t(i,{size:"24"},{default:l(()=>[t(V(he))]),_:1})]),s("div",lt,[s("div",ot,"Â¥"+m(M(p.totalRefund)),1),e[15]||(e[15]=s("div",{class:"stat-label"},"æ€»é€€æ¬¾æ”¯å‡º",-1))])])]),_:1})]),_:1})]),_:1}),t(n,{shadow:"never"},{header:l(()=>[s("div",st,[s("div",nt,[t(f,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=o=>h.value=o),placeholder:"æœç´¢å…³è”è®¢å•å·",style:{width:"250px","margin-right":"10px"},clearable:"",onInput:N},{prefix:l(()=>[t(i,null,{default:l(()=>[t(V(Te))]),_:1})]),_:1},8,["modelValue"]),t(w,{modelValue:I.value,"onUpdate:modelValue":e[1]||(e[1]=o=>I.value=o),placeholder:"å…¥è´¦çŠ¶æ€",clearable:"",style:{width:"120px","margin-right":"10px"},onChange:N},{default:l(()=>[t(r,{label:"å¾…å…¥è´¦",value:1}),t(r,{label:"å·²å…¥è´¦",value:2})]),_:1},8,["modelValue"]),t(y,{type:"primary",onClick:$},{default:l(()=>[t(i,{style:{"margin-right":"5px"}},{default:l(()=>[t(V(Me))]),_:1}),e[16]||(e[16]=u(" åˆ·æ–°æ•°æ® ",-1))]),_:1}),b.value.length>0?(T(),U("div",it,[s("span",dt,[e[17]||(e[17]=u("æ€»è®°å½•: ",-1)),s("strong",null,m(b.value.length),1)]),h.value||I.value?(T(),U("span",rt,[e[18]||(e[18]=u(" ç­›é€‰ç»“æžœ: ",-1)),s("strong",ut,m(z.value.length),1)])):L("",!0)])):L("",!0)]),t(y,{type:"success",icon:V(De),onClick:e[2]||(e[2]=o=>H())},{default:l(()=>[...e[19]||(e[19]=[u("å½•å…¥æ”¶å…¥",-1)])]),_:1},8,["icon"])])]),default:l(()=>[we((T(),j(le,{data:K.value,stripe:"",style:{width:"100%","margin-top":"10px"}},{default:l(()=>[t(_,{prop:"id",label:"ID",width:"80"}),t(_,{prop:"orderId",label:"å…³è”è®¢å•",width:"180"},{default:l(({row:o})=>[s("span",{innerHTML:Q(o.orderId)},null,8,ct)]),_:1}),t(_,{prop:"amount",label:"é‡‘é¢",width:"150"},{default:l(({row:o})=>[s("span",pt,"+Â¥"+m(M(o.amount)),1)]),_:1}),t(_,{prop:"paymentMethod",label:"æ”¯ä»˜æ–¹å¼",width:"120"},{default:l(({row:o})=>[t(P,{type:"info"},{default:l(()=>[u(m(ae(o.paymentMethod)),1)]),_:2},1024)]),_:1}),t(_,{prop:"status",label:"çŠ¶æ€",width:"120"},{default:l(({row:o})=>[t(P,{type:o.status===2?"success":"warning"},{default:l(()=>[u(m(o.status===2?"å·²å…¥è´¦":"å¾…å…¥è´¦"),1)]),_:2},1032,["type"])]),_:1}),t(_,{prop:"transactionTime",label:"äº¤æ˜“æ—¶é—´",width:"180"},{default:l(({row:o})=>[u(m(te(o.transactionTime)),1)]),_:1}),t(_,{prop:"remark",label:"å¤‡æ³¨","show-overflow-tooltip":""}),t(_,{label:"æ“ä½œ",width:"200",fixed:"right"},{default:l(({row:o})=>[o.status===1?(T(),j(y,{key:0,type:"success",link:"",size:"small",onClick:Y=>Z(o)},{default:l(()=>[...e[20]||(e[20]=[u("ç¡®è®¤å…¥è´¦",-1)])]),_:1},8,["onClick"])):L("",!0),t(y,{type:"primary",link:"",size:"small",onClick:Y=>H(o)},{default:l(()=>[...e[21]||(e[21]=[u("ç¼–è¾‘",-1)])]),_:1},8,["onClick"]),t(y,{type:"danger",link:"",size:"small",onClick:Y=>ee(o)},{default:l(()=>[...e[22]||(e[22]=[u("åˆ é™¤",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ue,D.value]]),s("div",mt,[t(oe,{"current-page":C.value,"onUpdate:currentPage":e[3]||(e[3]=o=>C.value=o),"page-size":R.value,"onUpdate:pageSize":e[4]||(e[4]=o=>R.value=o),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",total:z.value.length},null,8,["current-page","page-size","total"])])]),_:1}),t(re,{modelValue:E.value,"onUpdate:modelValue":e[12]||(e[12]=o=>E.value=o),title:x.value?"ç¼–è¾‘æ”¶å…¥":"å½•å…¥æ”¶å…¥",width:"500px"},{footer:l(()=>[s("span",ft,[t(y,{onClick:e[11]||(e[11]=o=>E.value=!1)},{default:l(()=>[...e[25]||(e[25]=[u("å–æ¶ˆ",-1)])]),_:1}),t(y,{type:"primary",loading:F.value,onClick:X},{default:l(()=>[...e[26]||(e[26]=[u("ç¡®å®š",-1)])]),_:1},8,["loading"])])]),default:l(()=>[t(de,{ref_key:"formRef",ref:B,model:d,rules:J,"label-width":"100px"},{default:l(()=>[t(k,{label:"å…³è”è®¢å•",prop:"orderId"},{default:l(()=>[t(f,{modelValue:d.orderId,"onUpdate:modelValue":e[5]||(e[5]=o=>d.orderId=o),placeholder:"è¯·è¾“å…¥è®¢å•å·",disabled:x.value},null,8,["modelValue","disabled"])]),_:1}),t(k,{label:"æ”¶å…¥é‡‘é¢",prop:"amount"},{default:l(()=>[t(se,{modelValue:d.amount,"onUpdate:modelValue":e[6]||(e[6]=o=>d.amount=o),precision:2,step:100,min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(k,{label:"æ”¯ä»˜æ–¹å¼",prop:"paymentMethod"},{default:l(()=>[t(w,{modelValue:d.paymentMethod,"onUpdate:modelValue":e[7]||(e[7]=o=>d.paymentMethod=o),placeholder:"è¯·é€‰æ‹©",style:{width:"100%"}},{default:l(()=>[t(r,{label:"æ”¯ä»˜å®",value:"alipay"}),t(r,{label:"å¾®ä¿¡æ”¯ä»˜",value:"wxpay"}),t(r,{label:"é“¶è¡Œå¡",value:"card"}),t(r,{label:"çŽ°é‡‘",value:"cash"})]),_:1},8,["modelValue"])]),_:1}),t(k,{label:"çŠ¶æ€",prop:"status"},{default:l(()=>[t(ne,{modelValue:d.status,"onUpdate:modelValue":e[8]||(e[8]=o=>d.status=o)},{default:l(()=>[t(A,{label:1},{default:l(()=>[...e[23]||(e[23]=[u("å¾…å…¥è´¦",-1)])]),_:1}),t(A,{label:2},{default:l(()=>[...e[24]||(e[24]=[u("å·²å…¥è´¦",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(k,{label:"äº¤æ˜“æ—¶é—´",prop:"transactionTime"},{default:l(()=>[t(ie,{modelValue:d.transactionTime,"onUpdate:modelValue":e[9]||(e[9]=o=>d.transactionTime=o),type:"datetime",placeholder:"é€‰æ‹©æ—¥æœŸæ—¶é—´",style:{width:"100%"},"value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),t(k,{label:"å¤‡æ³¨",prop:"remark"},{default:l(()=>[t(f,{modelValue:d.remark,"onUpdate:modelValue":e[10]||(e[10]=o=>d.remark=o),type:"textarea",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},It=ce(_t,[["__scopeId","data-v-f2a7e3f1"]]);export{It as default};
